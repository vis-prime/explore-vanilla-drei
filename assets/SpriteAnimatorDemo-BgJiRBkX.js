import{an as He,ay as Oe,r as Ge,j as Te,az as je,M as X,d as Ie,G as fe,s as ke,T as ce,av as Ve,W as Ye,a as Be,b as Xe,E as qe,C as Je,c as Ke,R as Ne,f as Ue,g as de,B as _e,aA as Qe}from"./three.module-N8Yg3gBE.js";import{S as Ze,O as $e,G as et,D as tt}from"./OrbitControls-l8VhczwG.js";import{H as at}from"./HDRLoader-apDHl61K.js";import{T as nt}from"./TransformControls-C-UG_SIt.js";import{M as st}from"./MODEL_LIST-DWUBpEFf.js";import{H as ot}from"./HDRI_LIST-DJCqOZOR.js";const Y=({startFrame:a,endFrame:n,fps:r,frameName:s,textureDataURL:f,textureImageURL:A,loop:mt,numberOfFrames:R,autoPlay:ft,animationNames:ge,onStart:N,onEnd:ut,onLoopEnd:U,onFrame:_,play:ye,pause:E,flipX:Se,alphaTest:Q,asSprite:W})=>{let u={frames:[],meta:{version:"1.0",size:{w:1,h:1},scale:"1"}},H=new He;const O=new Oe({toneMapped:!1,transparent:!0,map:H,alphaTest:Q}),Z=new Ge({toneMapped:!1,side:Te,map:H,transparent:!0,alphaTest:Q}),x=new je(O),G=new X(new Ie(1,1),Z);let d=O,v=x;const b=new fe;b.add(v);let $=window.performance.now(),S=a||0,T=s||"";const ee=1e3/(r||30),Ae=e=>{H=e,d&&(d.map=e)},be=new ke(1,1,1),ve=e=>{be.copy(e)},te=Se?-1:1;let j=W??!0;(e=>{j=e,j?(d=O,v=x,b.add(x),b.remove(G)):(d=Z,v=G,b.remove(x),b.add(G))})(j);async function Me(e,t,i){const o=new ce,l=fetch(e).then(c=>c.json()),p=new Promise(c=>{o.load(t,c)});await Promise.all([l,p]).then(c=>{i(c[0],c[1])})}const ae=(e,t)=>{const i=t/e;return v.scale.set(1,i,1),v.scale},xe=async()=>{if(f&&A)await Me(f,A,ne);else if(A){const t=await new ce().loadAsync(A);ne(null,t)}},Le=e=>{s=e,T!==s&&s&&(S=0,T=s)},ze=()=>{E=!0},Ce=()=>{ye=!0,E=!1},ne=(e,t)=>{if(e===null){if(t&&R){const i=t.image.width,o=t.image.height,l=i/R,p=o;if(u={frames:[],meta:{version:"1.0",size:{w:i,h:o},scale:"1"}},parseInt(l.toString(),10)===l)for(let c=0;c<R;c++)u.frames.push({frame:{x:c*l,y:0,w:l,h:p},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:l,h:p},sourceSize:{w:l,h:o}})}}else if(t){u=e,u.frames=Array.isArray(e.frames)?e.frames:De();const{w:i,h:o}=se(e.frames).sourceSize,l=ae(i,o);ve(l),d&&(d.map=t)}t.premultiplyAlpha=!1,Ae(t),Fe()},De=()=>{const e={},t=u,i=ge;if(i)for(let o=0;o<i.length;o++){e[i[o]]=[];for(const l in t.frames){const p=t.frames[l],c=p.frame,L=c.x,z=c.y,I=c.w,k=c.h,V=p.sourceSize.w,C=p.sourceSize.h;typeof l=="string"&&l.toLowerCase().indexOf(i[o].toLowerCase())!==-1&&e[i[o]].push({x:L,y:z,w:I,h:k,frame:c,sourceSize:{w:V,h:C}})}}return e},Fe=()=>{if(!(u&&d.map))return;const{meta:{size:e},frames:t}=u,{w:i,h:o}=Array.isArray(t)?t[0].sourceSize:s?t[s]?t[s][0].sourceSize:{w:0,h:0}:{w:0,h:0};d.map.wrapS=d.map.wrapT=Ve,d.map.center.set(0,0),d.map.repeat.set(1*te/(e.w/i),1/(e.h/o));const p=1/((e.h-1)/o);d.map.offset.x=0,d.map.offset.y=1-p,N&&N({currentFrameName:s,currentFrame:S})},Pe=()=>{if(!(u&&d.map))return;const e=window.performance.now(),t=e-$,{meta:{size:i},frames:o}=u,{w:l,h:p}=se(o).sourceSize,c=Array.isArray(o)?o:s?o[s]:[];let L=0,z=0;const I=n||c.length-1;if(S>I&&(S=a??0,U?.({currentFrameName:s,currentFrame:S})),t<=ee)return;$=e-t%ee,ae(l,p);const k=(i.w-1)/l,V=(i.h-1)/p,{frame:{x:C,y:Ee},sourceSize:{w:oe,h:We}}=c[S],re=1/k,ie=1/V;L=te>0?re*(C/oe):re*(C/oe)-d.map.repeat.x,z=Math.abs(1-ie)-ie*(Ee/We),d.map.offset.x=L,d.map.offset.y=z,S+=1},Re=()=>{var e,t;!((e=u)!=null&&e.frames)||!((t=d)!=null&&t.map)||E||(Pe(),_&&_({currentFrameName:T,currentFrame:S}))},se=e=>{if(Array.isArray(e))return e[0];if(typeof e=="object"&&e!==null){const t=Object.keys(e);return e[t[0]][0]}else return{w:0,h:0}};return{group:b,init:xe,update:Re,playAnimation:Ce,pauseAnimation:ze,setFrameName:Le}};let q,h,y,m,w,J,K=new Ke;const le={bgColor:new Je,printCam:()=>{}},M=new fe,rt=new at,ue=new et,we=new tt;let g;we.setDecoderPath("https://www.gstatic.com/draco/v1/decoders/");ue.setDRACOLoader(we);const pe=new Ne,D=[];let F;const P=[];async function vt(a){J=a,F=J.addFolder("Scene"),q=new Ze,app.appendChild(q.dom),h=new Ye({antialias:!0}),h.setPixelRatio(Math.min(1.5,window.devicePixelRatio)),h.setSize(window.innerWidth,window.innerHeight),h.shadowMap.enabled=!0,app.appendChild(h.domElement),y=new Be(50,window.innerWidth/window.innerHeight,.1,200),y.position.set(6,3,6),y.name="Camera",m=new Xe,rt.load(ot.skidpan.hdr,r=>{r.mapping=qe,m.backgroundBlurriness=.7,m.background=r,m.environment=r}),m.add(M),w=new $e(y,h.domElement),w.enableDamping=!0,w.dampingFactor=.05,w.minDistance=.1,w.maxDistance=100,w.maxPolarAngle=Math.PI/1.5,w.target.set(0,0,0),w.target.set(0,0,0),g=new nt(y,h.domElement),g.addEventListener("dragging-changed",r=>{w.enabled=!r.value,r.value||plm.recalculate()}),g.addEventListener("change",()=>{g.object&&g.object.position.y<0&&(g.object.position.y=0)}),window.addEventListener("resize",it),document.addEventListener("pointermove",me);let n=Date.now();document.addEventListener("pointerdown",()=>{n=Date.now()}),document.addEventListener("pointerup",r=>{Date.now()-n<200&&(me(r),dt())}),F.add(g,"mode",["translate","rotate","scale"]),F.add(m,"backgroundBlurriness",0,1,.01),F.addColor(le,"bgColor").onChange(()=>{m.background=le.bgColor}),await lt(),pt()}function it(){y.aspect=window.innerWidth/window.innerHeight,y.updateProjectionMatrix(),h.setSize(window.innerWidth,window.innerHeight)}function ct(){q.update(),w.update(),P.forEach(a=>{a()}),h.render(m,y)}function he(){requestAnimationFrame(he),ct()}function dt(){if(pe.setFromCamera(K,y),pe.intersectObject(M,!0,D),!D.length){g.detach();return}g.attach(D[0].object),D.length=0}function me(a){K.x=a.clientX/window.innerWidth*2-1,K.y=-(a.clientY/window.innerHeight)*2+1}async function lt(){const a=new X(new Ue(.5).translate(0,.5,0),new de({color:16777215*Math.random(),roughness:0,metalness:1}));a.name="sphere",a.castShadow=!0,a.receiveShadow=!0,a.position.set(2,0,-3),M.add(a);const n=new X(new _e(1,1,1).translate(0,.5,0),new de({color:16777215*Math.random(),roughness:.3,metalness:0}));n.name="cube",n.castShadow=!0,n.receiveShadow=!0,n.position.set(-1.5,0,-3),M.add(n);const s=(await ue.loadAsync(st.monkey.url)).scene;s.name="suzanne",s.traverse(f=>{f.isMesh&&(f.castShadow=!0,f.receiveShadow=!0)}),s.position.set(0,0,-3),M.add(s),m.add(new Qe(10,10)),he()}async function pt(){const a=Y({startFrame:0,fps:40,autoPlay:!0,loop:!0,textureImageURL:"./sprites/flame.png",textureDataURL:"./sprites/flame.json",alphaTest:.01});await a.init(),a.group.position.set(0,2,1.2),a.group.scale.set(4,4,4),m.add(a.group),P.push(a.update),B("flame NEW",a);const n=Y({startFrame:0,autoPlay:!0,loop:!0,numberOfFrames:16,alphaTest:.01,textureImageURL:"./sprites/alien.png",asSprite:!1});await n.init(),n.group.scale.set(1,1,1),n.group.position.set(-2,.5,2.5),m.add(n.group),B("Alien NEW",n),P.push(n.update);const r=Y({frameName:"idle",fps:24,animationNames:["idle","celebration"],autoPlay:!0,loop:!0,alphaTest:.01,textureImageURL:"./sprites/boy_hash.png",textureDataURL:"./sprites/boy_hash.json"});await r.init(),r.group.scale.set(1,1,1),r.group.position.set(-2,.5,-1),m.add(r.group),P.push(r.update),B("boySA NEW",r,["idle","celebration"])}function B(a,n,r=[]){const s=J.addFolder(a);s.add(n,"pauseAnimation"),s.add(n,"playAnimation");for(const f of r){const A={playAnim:()=>{n.setFrameName(f)}};s.add(A,"playAnim").name("play: "+f).onChange(()=>{n.setFrameName(f)})}}export{vt as default};
