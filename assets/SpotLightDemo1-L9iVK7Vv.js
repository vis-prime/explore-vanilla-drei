import{S as ne,W as se,V as ie,a as re,A as de,b as le,c as ce,z as pe,G as me,O as ge,d as ue,v as C,k as he,H as we,L as J,h as $,s as A,r as v,M as k,C as fe,t as ye,w as Se,x as Le,y as Pe,U as Re,i as be,n as ve,R as Me,o as Ce}from"./OrbitControls-R0lqBEeo.js";import{H as xe}from"./HDRI_LIST-DJCqOZOR.js";import{u as Fe,T as W,E as G}from"./tween.esm-DFB-vPb4.js";import{E as De,R as Ee,S as Te,a as Oe}from"./index-B2H7p6tS.js";import{B as Be}from"./BG_ENV-DvPFx4cR.js";import{a as X,M as Y}from"./MODEL_LIST-CX7Ggjim.js";import{L as ze}from"./LoadingHelper-Bpwvv_dV.js";import{S as j}from"./SpotLightMaterial-CnHQ0_Q-.js";import"./EXRLoader-CueWY_mu.js";import"./RGBELoader-C-6F00h6.js";import"./GroundProjectedSkybox-C8DAfX2s.js";import"./shaderMaterial-CnuFB52m.js";import"./constants-CqDbEtfV.js";let U,y,T,O,w,S,R,P,K=new ue;const _e={pixelRatio:Math.min(1.5,window.devicePixelRatio)},_=new me,Ve=new be,ee=new ve;ee.setDecoderPath("https://www.gstatic.com/draco/v1/decoders/");Ve.setDRACOLoader(ee);new Me;let te=()=>{},N;const V=new ze({debug:!0});async function at(d){P=d,N=P.addFolder("Scene"),U=new ne,app.appendChild(U.dom),y=new se({powerPreference:"high-performance",antialias:!1,stencil:!1,depth:!1}),y.setPixelRatio(_e.pixelRatio),y.setSize(window.innerWidth,window.innerHeight),y.shadowMap.enabled=!0,y.shadowMap.type=ie,y.outputColorSpace=re,y.toneMapping=de,app.appendChild(y.domElement),w=new le(50,window.innerWidth/window.innerHeight,.1,200),w.position.set(5,2,5),w.name="Camera",S=new ce,S.fog=new pe(0,10,20),S.add(_),T=new De(y),T.addPass(new Ee(S,w)),O=new Te(S,w,{resolutionScale:.4,luminanceThreshold:0,intensity:120,mipmapBlur:!0,levels:4,radius:.4}),O.ignoreBackground=!0;const r=new Oe(w,O);T.addPass(r),R=new ge(w,y.domElement),R.enableDamping=!0,R.dampingFactor=.05,R.minDistance=.5,R.maxDistance=20,R.maxPolarAngle=Math.PI/1.5,R.target.set(0,0,0),window.addEventListener("resize",He),document.addEventListener("pointermove",Z);let a=Date.now();app.addEventListener("pointerdown",()=>{a=Date.now()}),app.addEventListener("pointerup",c=>{Date.now()-a<200&&Z(c)});const e=new Be(S,{loadingHelper:V});e.preset=xe.kloppenheim,e.setEnvType("HDRI"),e.setBGType("Default"),e.addGui(N),S.backgroundBlurriness=.1,S.backgroundIntensity=.01,S.environmentIntensity=.1,N.add(S,"environmentIntensity",0,1),oe(),await Promise.all([e.updateAll(),Ge()]),ae()}function He(){w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),T.setSize(window.innerWidth,window.innerHeight)}function oe(){U.update(),Fe(),te(),R.update(),T.render()}function ae(){requestAnimationFrame(ae),oe()}function Z(d){K.x=d.clientX/window.innerWidth*2-1,K.y=-(d.clientY/window.innerHeight)*2+1}const z=(d,r,a)=>{const e=new Se(r,a,d,128,64,!0);return e.translate(0,-d/2,0),e.rotateX(-Math.PI/2),e},M=(d,r,a)=>{r.material.attenuation=d.distance;let e=Math.tan(d.angle)*d.distance;r.geometry=z(d.distance,a,e)};function Ie({size:d,frames:r=1/0}={}){const a=y,e=new C;a.getSize(e);const c=d||e.x,o=d||e.y;console.log("depth tex res",c,o);const t=new Le(c,o);t.format=Pe,t.type=Re,t.name="Depth_Buffer";let i=0;const p=We(c,o,{depthTexture:t}),m=()=>{(r===1/0||i<r)&&(a.setRenderTarget(p),a.render(S,w),a.setRenderTarget(null),i++)};return[p.depthTexture,m]}function We(d,r,a){const e=y,c=d,o=r,t=a,{samples:i=0,depth:p,...m}=t;let g;return g=new he(c,o,{minFilter:J,magFilter:J,colorSpace:e.outputColorSpace,type:we,...m}),g.samples=i,g}async function Ge(){const d=[],r={speed:10,useDepth:!1,depthResolution:1024},[a,e,c]=await Promise.all([Ae(),Ne(d),ke(d)]),o=new C,t=()=>{r.useDepth&&(y.getSize(o),o.multiplyScalar(y.getPixelRatio()))};window.addEventListener("resize",t);let i=()=>{};function p(){if(r.useDepth){const s=Ie({size:r.depthResolution});let l;for(const n of d)l=n.depth,n.depth=s[0],n.resolution=o;t(),i=s[1],l&&l.dispose()}else for(const s of d)s.depth=null,s.resolution.set(0,0)}P.add(r,"useDepth").onChange(p),P.add(r,"depthResolution",128,1024,128).onChange(p),P.add(r,"speed",.1,20).onChange();const m=new Ce(!0);let g,u;te=()=>{if(u=m.getDelta()*r.speed,a(u),e(u),c(u),S.environmentRotation.y+=w.position.x>0?u*.01:-u*.01,r.useDepth){for(const s of d)g=s.depth,s.depth=null;i();for(const s of d)s.depth=g}}}async function Ne(d){const a=(await X(Y.porsche_1975.url,{loadingHelper:V})).scene;a.name="car",a.traverse(f=>{f.isMesh&&(f.selectOnRaycast=a,f.material.transparent||(f.castShadow=!0,f.receiveShadow=!0))}),_.add(a);const e={FL:a.getObjectByName("wheel_L"),FR:a.getObjectByName("wheel_R"),R:a.getObjectByName("wheels_rear"),body:a.getObjectByName("body"),steerL:a.getObjectByName("steer_L"),steerR:a.getObjectByName("steer_R"),steerVal:0,emit:a.getObjectByName("emit"),lights:a.getObjectByName("lights"),wheenSpinMultiplier:1.8};e.emit.material=new $,e.emit.material.color.set(0),e.emit.material.emissive.set("#ffbb73"),e.lights.material.emissiveIntensity=3,P.add(e.emit.material,"emissiveIntensity",0,50),P.add(e.lights.material,"emissiveIntensity",0,50),O.selection.add(e.emit);const c={distance:8},o=new A;o.intensity=500,o.color.set("#ffbb73"),o.angle=v.degToRad(20),o.penumbra=.2,o.distance=c.distance;const t=o.clone();a.add(o,t),a.add(o.target,t.target),o.position.set(-.66,.66,2),o.target.position.set(-.66,.25,10),t.position.set(.66,.66,2),t.target.position.set(.66,.25,10);let i=.08;const p=new j;p.spotPosition=new C,p.opacity=1,p.lightColor=o.color,p.attenuation=c.distance,p.anglePower=5,p.cameraNear=w.near,p.cameraFar=w.far;const m=new j;m.spotPosition=new C,m.opacity=1,m.lightColor=t.color,m.attenuation=c.distance,m.anglePower=p.anglePower,m.cameraNear=w.near,m.cameraFar=w.far,d.push(p,m);const g=new k(z(c.distance,i,.5),p),u=new k(z(c.distance,i,.5),m);o.add(g),t.add(u);const s=new C;g.lookAt(o.target.position),u.lookAt(t.target.position),M(o,g,i),M(t,u,i);const l=new A(16711680,.05);l.penumbra=1,l.position.set(.62,.64,-2),l.target.position.set(.62,0,-4);const n=l.clone();n.position.set(-.62,.64,-2),n.target.position.set(-.62,0,-4),a.add(l,l.target,n,n.target);function h(f){const D=f.addFolder("HeadLight"),Q=D.addFolder("Headlights Volume");Q.add(p,"opacity",0,2).onChange(E=>{m.opacity=E}),Q.add(p,"anglePower",0,15).onChange(E=>{m.anglePower=E}),D.addColor(o,"color").onChange(()=>{t.color.copy(o.color)}),D.add(o,"intensity",0,1e3).onChange(()=>{t.intensity=o.intensity}),D.add(o,"angle",0,Math.PI/2).onChange(()=>{t.angle=o.angle,M(o,g,i),M(t,u,i)}),D.add(o,"penumbra",0,1).onChange(()=>{t.penumbra=o.penumbra}),D.add(c,"distance",.1,20).onChange(E=>{o.distance=E,t.distance=E,M(o,g,i),M(t,u,i)})}h(P);const b=v.degToRad(15),L=v.degToRad(5),x=.25;function q(){const f=v.mapLinear(e.steerVal,-1,1,-b,b);e.steerL.rotation.y=f,e.steerR.rotation.y=f,e.body.rotation.z=v.mapLinear(e.steerVal,-1,1,-L,L)}const H=new W(e).to({steerVal:0}).duration(1e3).easing(G.Elastic.Out).onStart(()=>{H._valuesStart.steerVal=e.steerVal}).onUpdate(()=>{q()});let I=!0;const F=new W(e).to({steerVal:1}).duration(1e3).easing(G.Back.Out).delay(1e3).onStart(()=>{F.delay(v.randInt(100,4e3)),I?(F._valuesEnd.steerVal=1,B._valuesEnd.x=x):(F._valuesEnd.steerVal=-1,B._valuesEnd.x=-x),I=!I,B.start()}).onUpdate(()=>{q()});F.chain(H),H.chain(F),setTimeout(()=>{F.startFromCurrentValues()},2e3);const B=new W(a.position).to({x:0}).duration(2e3).easing(G.Quadratic.InOut).onStart(()=>{B._valuesStart.x=a.position.x});return f=>{p.spotPosition.copy(g.getWorldPosition(s)),m.spotPosition.copy(u.getWorldPosition(s)),e.FL.rotation.x+=f*e.wheenSpinMultiplier,e.FR.rotation.x+=f*e.wheenSpinMultiplier,e.R.rotation.x+=f*e.wheenSpinMultiplier}}async function Ae(){const r=(await X(Y.road.url,{loadingHelper:V})).scene;r.name="road",r.traverse(t=>{t.isMesh&&(t.selectOnRaycast=r,t.castShadow=!0,t.receiveShadow=!0)});const a=8,e=12,c=a*e,o=[];for(let t=0;t<a;t++){const i=r.clone();i.position.z=t*e-c/2,_.add(i),o.push(i)}return t=>{o.forEach(i=>{i.position.z-=t,i.position.z<-c/2&&(i.position.z+=c)})}}async function ke(d){const r=new C,a=.1,c=(await X(Y.pole.url,{loadingHelper:V})).scene;c.name="pole";const o=new fe("#ffbb73");c.position.set(-6,0,0),c.rotation.y=Math.PI/2;const t=c.getObjectByName("emit");t.material=new $,t.material.color.set(0),t.material.emissive.set("#ffbb73"),t.castShadow=!1,t.receiveShadow=!1;const i=[],p=[],m=[],g={gap:15,intensity:1e3,color:o,helper:!1},u=P.addFolder("Street Lamps");u.addColor(g,"color"),u.add(g,"intensity",0,2e3).onChange(s=>{m.forEach(l=>{l.intensity=s})}),u.add(g,"gap",10,30,1).onChange(()=>{for(let s=0;s<i.length;s++){const l=i[s];l.position.z=s*g.gap,console.log(s,l.position.z)}}),O.selection.add(t);for(let s=0;s<4;s++){const l=c.clone();i.push(l),l.position.z=s*g.gap;const n=new A;m.push(n),n.color=o,n.intensity=g.intensity,n.angle=v.degToRad(30),n.penumbra=.5,n.distance=12,n.position.set(0,7.2,1.8),n.target.position.set(0,0,7),n.castShadow=!0,n.shadow.bias=-1e-4,n.radius=1,n.blurSamples=4;const h=new j;console.log(h.uuid),d.push(h),h.spotPosition=new C,h.opacity=.5,h.lightColor=o,h.anglePower=5,h.cameraNear=w.near,h.cameraFar=w.far;const b=new k(z(n.distance,a,.5),h);n.add(b),M(n,b,a),b.lookAt(n.target.getWorldPosition(r)),p.push(b);const L=u.addFolder("lamp "+s);L.add(n.shadow,"bias",-1e-4,1e-4).onChange(()=>{}),L.add(h,"opacity",0,2),L.add(h,"attenuation",0,n.distance),L.add(h,"anglePower",0,15),L.add(h,"cameraNear",0,10),L.add(h,"cameraFar",0,10),l.add(n,n.target);const x=new ye(n);n.helper=x,x.visible=g.helper,S.add(x),_.add(l)}for(let s=0;s<m.length;s++){const l=m[s];p[s].material.spotPosition.copy(l.getWorldPosition(r)),p[s].lookAt(l.target.getWorldPosition(r))}return s=>{for(let l=0;l<i.length;l++){const n=i[l];n.position.z-=s,n.position.z<-g.gap/2*i.length&&(n.position.z+=g.gap*i.length),g.helper&&m.forEach(h=>{h.helper.update()}),p[l].material.spotPosition.copy(p[l].getWorldPosition(r))}}}export{at as default,We as useFBO};
