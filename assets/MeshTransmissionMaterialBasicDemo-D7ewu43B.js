import{S as A,O as H,G as W,D as P}from"./OrbitControls-FqkbUa6U.js";import{T as z}from"./TransformControls-DIS8GcSd.js";import{W as V,V as I,S as N,A as _,a as q,b as X,G as Y,c as J,R as K,i as v,H as D,L as g,l as Q,N as U,k as Z}from"./three.module-CpOMtsua.js";import{M as $}from"./MODEL_LIST-Bh-xXQZi.js";import{B as ee}from"./BG_ENV-DSI1sdw8.js";import{M as te}from"./MeshDiscardMaterial-D-pamrVR.js";import{M as ae}from"./MeshTransmissionMaterial-BGmKl5db.js";import"./EXRLoader-DkJrvfaI.js";import"./HDRLoader-CNYvXwJL.js";import"./GroundProjectedSkybox-DU_m07Wz.js";import"./HDRI_LIST-DJCqOZOR.js";import"./shaderMaterial-BSjRKRz3.js";let b,a,d,p,c,M,k=new J;const T=new Y,G=new W,x=new P;let r;x.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.5/");G.setDRACOLoader(x);const E=new K,m=[];let j=()=>{},h;async function ke(n){M=n,h=M.addFolder("Scene"),b=new A,app.appendChild(b.dom),a=new V({antialias:!0}),a.setPixelRatio(Math.min(1.5,window.devicePixelRatio)),a.setSize(window.innerWidth,window.innerHeight),a.shadowMap.enabled=!0,a.shadowMap.type=I,a.outputColorSpace=N,a.toneMapping=_,app.appendChild(a.domElement),d=new q(50,window.innerWidth/window.innerHeight,.1,200),d.position.set(2,2,2),d.name="Camera",p=new X,p.add(T),c=new H(d,a.domElement),c.enableDamping=!0,c.dampingFactor=.05,c.minDistance=.1,c.maxDistance=100,c.maxPolarAngle=Math.PI/1.5,c.target.set(0,.5,0),r=new z(d,a.domElement),r.addEventListener("dragging-changed",e=>{c.enabled=!e.value,e.value}),r.addEventListener("change",()=>{r.object&&r.object.position.y<0&&(r.object.position.y=0)}),p.add(r.getHelper()),window.addEventListener("resize",ne),document.addEventListener("pointermove",F);let o=Date.now();app.addEventListener("pointerdown",()=>{o=Date.now()}),app.addEventListener("pointerup",e=>{Date.now()-o<200&&(F(e),ie())}),h.add(r,"mode",["translate","rotate","scale"]);const i=new ee(p);i.setBGType("GroundProjection"),i.setEnvType("HDRI"),i.updateAll(),i.addGui(h),await re(),B()}function ne(){d.aspect=window.innerWidth/window.innerHeight,d.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight)}function oe(){b.update(),c.update(),j(),a.render(p,d)}function B(){requestAnimationFrame(B),oe()}function ie(){if(E.setFromCamera(k,d),E.intersectObject(T,!0,m),!m.length){r.detach();return}m[0].object.selectOnRaycast?r.attach(m[0].object.selectOnRaycast):r.attach(m[0].object),m.length=0}function F(n){k.x=n.clientX/window.innerWidth*2-1,k.y=-(n.clientY/window.innerHeight)*2+1}async function re(){const n={customBackground:p.background,backside:!0,thickness:1,backsideThickness:.5},i=(await G.loadAsync($.monkey.url)).scene,e=new te,f=new ae({anisotropy:.5}),S=[];i.traverse(l=>{l.isMesh&&(l.castShadow=!0,l.receiveShadow=!0,l.selectOnRaycast=i,l.material=f,S.push(l))}),T.add(i),se(M,f,n);const y=new v(512,512,{minFilter:g,magFilter:g,colorSpace:a.outputColorSpace,type:D}),w=new v(512,512,{minFilter:g,magFilter:g,colorSpace:a.outputColorSpace,type:D}),u=f;u.buffer=w.texture;let C,L,R;const t={gl:a,scene:p,camera:d},O=new Q(!0);j=()=>{u.time=O.getElapsedTime();for(const l of S){const s=l;u.buffer===w.texture&&(L=t.gl.toneMapping,C=t.scene.background,R=s.material.side,t.gl.toneMapping=U,n.background&&(t.scene.background=n.background),s.material=e,n.backside&&(t.gl.setRenderTarget(y),t.gl.render(t.scene,t.camera),s.material=u,s.material.buffer=y.texture,s.material.thickness=n.backsideThickness,s.material.side=Z),t.gl.setRenderTarget(w),t.gl.render(t.scene,t.camera),s.material=u,s.material.thickness=n.thickness,s.material.side=R,s.material.buffer=w.texture,t.scene.background=C,t.gl.setRenderTarget(null),t.gl.toneMapping=L)}}}function se(n,o,i){const e=n.addFolder("Transmission Material");e.open(),e.add(i,"backside"),e.add(i,"thickness",0,2),e.add(i,"backsideThickness",0,2),e.addColor(o,"color"),e.add(o,"roughness",0,1),e.add(o,"chromaticAberration",0,2),e.add(o,"distortion",0,10),e.add(o,"temporalDistortion",0,1),e.add(o,"anisotropicBlur",0,10),e.add(o,"reflectivity",0,1),e.addColor(o,"attenuationColor"),e.add(o,"attenuationDistance",0,2)}export{ke as default};
