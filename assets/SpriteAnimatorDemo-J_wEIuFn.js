import{ar as He,aC as Oe,u as Ge,l as Te,aD as Ie,M as X,e as je,G as fe,v as ke,T as ce,az as Ve,S as Be,W as Ye,b as Xe,c as qe,E as Je,O as Ke,C as Ne,d as Ue,R as _e,g as Qe,h as le,B as Ze,i as $e,aE as et,n as tt}from"./OrbitControls-R0lqBEeo.js";import{R as at}from"./RGBELoader-C-6F00h6.js";import{T as nt}from"./TransformControls-C9PpcTYI.js";import{M as st}from"./MODEL_LIST-CX7Ggjim.js";import{H as ot}from"./HDRI_LIST-DJCqOZOR.js";const B=({startFrame:a,endFrame:n,fps:r,frameName:s,textureDataURL:f,textureImageURL:A,loop:mt,numberOfFrames:R,autoPlay:ft,animationNames:ge,onStart:N,onEnd:ut,onLoopEnd:U,onFrame:_,play:ye,pause:P,flipX:Se,alphaTest:Q,asSprite:W})=>{let u={frames:[],meta:{version:"1.0",size:{w:1,h:1},scale:"1"}},H=new He;const O=new Oe({toneMapped:!1,transparent:!0,map:H,alphaTest:Q}),Z=new Ge({toneMapped:!1,side:Te,map:H,transparent:!0,alphaTest:Q}),x=new Ie(O),G=new X(new je(1,1),Z);let l=O,v=x;const b=new fe;b.add(v);let $=window.performance.now(),S=a||0,T=s||"";const ee=1e3/(r||30),Ae=e=>{H=e,l&&(l.map=e)},be=new ke(1,1,1),ve=e=>{be.copy(e)},te=Se?-1:1;let I=W??!0;(e=>{I=e,I?(l=O,v=x,b.add(x),b.remove(G)):(l=Z,v=G,b.remove(x),b.add(G))})(I);async function Me(e,t,i){const o=new ce,d=fetch(e).then(c=>c.json()),p=new Promise(c=>{o.load(t,c)});await Promise.all([d,p]).then(c=>{i(c[0],c[1])})}const ae=(e,t)=>{const i=t/e;return v.scale.set(1,i,1),v.scale},xe=async()=>{if(f&&A)await Me(f,A,ne);else if(A){const t=await new ce().loadAsync(A);ne(null,t)}},Ce=e=>{s=e,T!==s&&s&&(S=0,T=s)},Le=()=>{P=!0},ze=()=>{ye=!0,P=!1},ne=(e,t)=>{if(e===null){if(t&&R){const i=t.image.width,o=t.image.height,d=i/R,p=o;if(u={frames:[],meta:{version:"1.0",size:{w:i,h:o},scale:"1"}},parseInt(d.toString(),10)===d)for(let c=0;c<R;c++)u.frames.push({frame:{x:c*d,y:0,w:d,h:p},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:d,h:p},sourceSize:{w:d,h:o}})}}else if(t){u=e,u.frames=Array.isArray(e.frames)?e.frames:De();const{w:i,h:o}=se(e.frames).sourceSize,d=ae(i,o);ve(d),l&&(l.map=t)}t.premultiplyAlpha=!1,Ae(t),Ee()},De=()=>{const e={},t=u,i=ge;if(i)for(let o=0;o<i.length;o++){e[i[o]]=[];for(const d in t.frames){const p=t.frames[d],c=p.frame,C=c.x,L=c.y,j=c.w,k=c.h,V=p.sourceSize.w,z=p.sourceSize.h;typeof d=="string"&&d.toLowerCase().indexOf(i[o].toLowerCase())!==-1&&e[i[o]].push({x:C,y:L,w:j,h:k,frame:c,sourceSize:{w:V,h:z}})}}return e},Ee=()=>{if(!(u&&l.map))return;const{meta:{size:e},frames:t}=u,{w:i,h:o}=Array.isArray(t)?t[0].sourceSize:s?t[s]?t[s][0].sourceSize:{w:0,h:0}:{w:0,h:0};l.map.wrapS=l.map.wrapT=Ve,l.map.center.set(0,0),l.map.repeat.set(1*te/(e.w/i),1/(e.h/o));const p=1/((e.h-1)/o);l.map.offset.x=0,l.map.offset.y=1-p,N&&N({currentFrameName:s,currentFrame:S})},Fe=()=>{if(!(u&&l.map))return;const e=window.performance.now(),t=e-$,{meta:{size:i},frames:o}=u,{w:d,h:p}=se(o).sourceSize,c=Array.isArray(o)?o:s?o[s]:[];let C=0,L=0;const j=n||c.length-1;if(S>j&&(S=a??0,U?.({currentFrameName:s,currentFrame:S})),t<=ee)return;$=e-t%ee,ae(d,p);const k=(i.w-1)/d,V=(i.h-1)/p,{frame:{x:z,y:Pe},sourceSize:{w:oe,h:We}}=c[S],re=1/k,ie=1/V;C=te>0?re*(z/oe):re*(z/oe)-l.map.repeat.x,L=Math.abs(1-ie)-ie*(Pe/We),l.map.offset.x=C,l.map.offset.y=L,S+=1},Re=()=>{var e,t;!((e=u)!=null&&e.frames)||!((t=l)!=null&&t.map)||P||(Fe(),_&&_({currentFrameName:T,currentFrame:S}))},se=e=>{if(Array.isArray(e))return e[0];if(typeof e=="object"&&e!==null){const t=Object.keys(e);return e[t[0]][0]}else return{w:0,h:0}};return{group:b,init:xe,update:Re,playAnimation:ze,pauseAnimation:Le,setFrameName:Ce}};let q,h,y,m,w,J,K=new Ue;const de={bgColor:new Ne,printCam:()=>{}},M=new fe,rt=new at,ue=new $e,we=new tt;let g;we.setDecoderPath("https://www.gstatic.com/draco/v1/decoders/");ue.setDRACOLoader(we);const pe=new _e,D=[];let E;const F=[];async function bt(a){J=a,E=J.addFolder("Scene"),q=new Be,app.appendChild(q.dom),h=new Ye({antialias:!0}),h.setPixelRatio(Math.min(1.5,window.devicePixelRatio)),h.setSize(window.innerWidth,window.innerHeight),h.shadowMap.enabled=!0,app.appendChild(h.domElement),y=new Xe(50,window.innerWidth/window.innerHeight,.1,200),y.position.set(6,3,6),y.name="Camera",m=new qe,rt.load(ot.skidpan.hdr,r=>{r.mapping=Je,m.backgroundBlurriness=.7,m.background=r,m.environment=r}),m.add(M),w=new Ke(y,h.domElement),w.enableDamping=!0,w.dampingFactor=.05,w.minDistance=.1,w.maxDistance=100,w.maxPolarAngle=Math.PI/1.5,w.target.set(0,0,0),w.target.set(0,0,0),g=new nt(y,h.domElement),g.addEventListener("dragging-changed",r=>{w.enabled=!r.value,r.value||plm.recalculate()}),g.addEventListener("change",()=>{g.object&&g.object.position.y<0&&(g.object.position.y=0)}),window.addEventListener("resize",it),document.addEventListener("pointermove",me);let n=Date.now();document.addEventListener("pointerdown",()=>{n=Date.now()}),document.addEventListener("pointerup",r=>{Date.now()-n<200&&(me(r),lt())}),E.add(g,"mode",["translate","rotate","scale"]),E.add(m,"backgroundBlurriness",0,1,.01),E.addColor(de,"bgColor").onChange(()=>{m.background=de.bgColor}),await dt(),pt()}function it(){y.aspect=window.innerWidth/window.innerHeight,y.updateProjectionMatrix(),h.setSize(window.innerWidth,window.innerHeight)}function ct(){q.update(),w.update(),F.forEach(a=>{a()}),h.render(m,y)}function he(){requestAnimationFrame(he),ct()}function lt(){if(pe.setFromCamera(K,y),pe.intersectObject(M,!0,D),!D.length){g.detach();return}g.attach(D[0].object),D.length=0}function me(a){K.x=a.clientX/window.innerWidth*2-1,K.y=-(a.clientY/window.innerHeight)*2+1}async function dt(){const a=new X(new Qe(.5).translate(0,.5,0),new le({color:16777215*Math.random(),roughness:0,metalness:1}));a.name="sphere",a.castShadow=!0,a.receiveShadow=!0,a.position.set(2,0,-3),M.add(a);const n=new X(new Ze(1,1,1).translate(0,.5,0),new le({color:16777215*Math.random(),roughness:.3,metalness:0}));n.name="cube",n.castShadow=!0,n.receiveShadow=!0,n.position.set(-1.5,0,-3),M.add(n);const s=(await ue.loadAsync(st.monkey.url)).scene;s.name="suzanne",s.traverse(f=>{f.isMesh&&(f.castShadow=!0,f.receiveShadow=!0)}),s.position.set(0,0,-3),M.add(s),m.add(new et(10,10)),he()}async function pt(){const a=B({startFrame:0,fps:40,autoPlay:!0,loop:!0,textureImageURL:"./sprites/flame.png",textureDataURL:"./sprites/flame.json",alphaTest:.01});await a.init(),a.group.position.set(0,2,1.2),a.group.scale.set(4,4,4),m.add(a.group),F.push(a.update),Y("flame NEW",a);const n=B({startFrame:0,autoPlay:!0,loop:!0,numberOfFrames:16,alphaTest:.01,textureImageURL:"./sprites/alien.png",asSprite:!1});await n.init(),n.group.scale.set(1,1,1),n.group.position.set(-2,.5,2.5),m.add(n.group),Y("Alien NEW",n),F.push(n.update);const r=B({frameName:"idle",fps:24,animationNames:["idle","celebration"],autoPlay:!0,loop:!0,alphaTest:.01,textureImageURL:"./sprites/boy_hash.png",textureDataURL:"./sprites/boy_hash.json"});await r.init(),r.group.scale.set(1,1,1),r.group.position.set(-2,.5,-1),m.add(r.group),F.push(r.update),Y("boySA NEW",r,["idle","celebration"])}function Y(a,n,r=[]){const s=J.addFolder(a);s.add(n,"pauseAnimation"),s.add(n,"playAnimation");for(const f of r){const A={playAnim:()=>{n.setFrameName(f)}};s.add(A,"playAnim").name("play: "+f).onChange(()=>{n.setFrameName(f)})}}export{bt as default};
