import{W as ee,V as ae,S as _,A as ne,P as oe,a as te,b as re,G as V,c as se,R as ie,D as de,M as T,d as le,e as ce,C as X,f as me,g as A,B as ue,E as L,T as he,h as pe,i as O,H as B,L as k,j as fe,k as q,F as we,l as ge,N as be}from"./three.module-CpOMtsua.js";import{S as Me,O as ye,G as Se,D as ke}from"./OrbitControls-FqkbUa6U.js";import{E as Ce}from"./EXRLoader-DkJrvfaI.js";import{G as xe}from"./GroundProjectedSkybox-DU_m07Wz.js";import{T as Pe}from"./TransformControls-DIS8GcSd.js";import{H as N}from"./HDRI_LIST-DJCqOZOR.js";import{H as Le}from"./HDRLoader-CNYvXwJL.js";import{M as Te}from"./MODEL_LIST-C-sQ1-VY.js";import{M as Ee}from"./MeshDiscardMaterial-D-pamrVR.js";import{M as Re}from"./MeshTransmissionMaterial-BGmKl5db.js";import"./shaderMaterial-BSjRKRz3.js";let E,d,h,s,p,b,m,R=new se;const f={environment:N.ulmer_muenster,groundProjection:!0,bgColor:new X,printCam:()=>{}},M=new V,je=new he,Fe=new Ce,Ge=new Le,Y=new Se,J=new ke;let u;J.setDecoderPath("https://www.gstatic.com/draco/v1/decoders/");Y.setDRACOLoader(J);const W=new ie,w=[];let K=()=>{},C,z;async function $e(o){b=o,C=b.addFolder("Scene"),E=new Me,app.appendChild(E.dom),d=new ee({antialias:!0}),d.setPixelRatio(Math.min(1.5,window.devicePixelRatio)),d.setSize(window.innerWidth,window.innerHeight),d.shadowMap.enabled=!0,d.shadowMap.type=ae,d.outputColorSpace=_,d.toneMapping=ne,z=new oe(d),z.compileCubemapShader(),app.appendChild(d.domElement),h=new te(50,window.innerWidth/window.innerHeight,.1,200),h.position.set(6,3,6),h.name="Camera",h.position.set(2.0404140991899564,2.644387886134694,3.8683136783076355),s=new re,s.add(M),p=new ye(h,d.domElement),p.enableDamping=!0,p.dampingFactor=.05,p.minDistance=.1,p.maxDistance=100,p.maxPolarAngle=Math.PI/1.5,p.target.set(0,0,0),p.target.set(0,0,0),u=new Pe(h,d.domElement),u.addEventListener("dragging-changed",a=>{p.enabled=!a.value,a.value}),u.addEventListener("change",()=>{u.object&&u.object.position.y<0&&(u.object.position.y=0)}),s.add(u.getHelper()),window.addEventListener("resize",He),document.addEventListener("pointermove",D);let e=Date.now();app.addEventListener("pointerdown",()=>{e=Date.now()}),app.addEventListener("pointerup",a=>{Date.now()-e<200&&(D(a),Oe())}),C.add(u,"mode",["translate","rotate","scale"]),ve(),await Be(),Q()}async function ve(){let o=new V,e=new de(16777195,1);e.name="Dir. Light",e.castShadow=!0,e.shadow.camera.near=.1,e.shadow.camera.far=50,e.shadow.camera.right=15,e.shadow.camera.left=-15,e.shadow.camera.top=15,e.shadow.camera.bottom=-15,e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,e.shadow.radius=1.95,e.shadow.blurSamples=6,e.shadow.bias=-5e-4,o.add(e),s.add(o);const a=new T(new le(10,10).rotateX(-Math.PI/2),new ce({}));a.name="shadowFloor",a.receiveShadow=!0,a.position.set(0,0,0),s.add(a);async function t(n){if(!n){s.background=null,s.environment=null;return}if(n.exr){const c=await Fe.loadAsync(n.exr);c.mapping=L,s.environment=c,console.log("exr loaded")}if(n.hdr){const c=await Ge.loadAsync(n.hdr);c.mapping=L,s.environment=c,console.log("exr loaded")}if(n.webP||n.avif){const c=await je.loadAsync(n.webP||n.avif);c.mapping=L,c.colorSpace=_,s.background=c,console.log("bg loaded"),f.groundProjection&&x(f.environment)}n.sunPos?(e.visible=!0,e.position.fromArray(n.sunPos)):e.visible=!1,n.sunCol?e.color.set(n.sunCol):e.color.set(16777215),n.shadowOpacity&&(a.material.opacity=n.shadowOpacity)}function x(n){f.groundProjection&&s.background&&n.groundProj?(m||(m=new xe(s.background),m.scale.setScalar(100)),m.material.uniforms.map.value=s.background,m.radius=n.groundProj.radius,m.height=n.groundProj.height,m.parent||s.add(m)):m&&m.parent&&m.removeFromParent()}t(f.environment),C.add(f,"environment",N).onChange(n=>{t(n)}),C.add(f,"groundProjection").onChange(n=>{x(f.environment)})}function He(){h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),d.setSize(window.innerWidth,window.innerHeight)}function Ae(){E.update(),p.update(),K(),d.render(s,h)}function Q(){requestAnimationFrame(Q),Ae()}function Oe(){if(W.setFromCamera(R,h),W.intersectObject(M,!0,w),!w.length){u.detach();return}w[0].object.selectOnRaycast?u.attach(w[0].object.selectOnRaycast):u.attach(w[0].object),w.length=0}function D(o){R.x=o.clientX/window.innerWidth*2-1,R.y=-(o.clientY/window.innerHeight)*2+1}async function Be(){const o=new T(new me(.5).translate(0,.5,0),new A({color:I(),roughness:0,metalness:1}));o.name="sphere",o.castShadow=!0,o.receiveShadow=!0,o.position.set(2,0,-1.5),M.add(o);const e=new T(new ue(1,1,1).translate(0,.5,0),new A({color:I(),roughness:0,metalness:1}));e.name="cube",e.castShadow=!0,e.receiveShadow=!0,e.position.set(-2,0,-1.5),M.add(e),We()}async function We(){const o={default:"def",physical:"phy",transmission:"tra"},e={carMaterial:o.default},a={renderEachMesh:!1,enabled:!1,customBackground:s.background,backside:!0,thickness:1,backsideThickness:.5},t=[],n=(await Y.loadAsync(Te.porsche_1975.url)).scene;n.name="car";let c;const U=new Ee,y=new Re(6,!1),j=new pe({roughness:0,transmission:1,thickness:1});n.traverse(i=>{if(i.isMesh){i.castShadow=!0,i.receiveShadow=!0,i.selectOnRaycast=n;const r=i.material;t.push({material:r,mesh:i,physical:j,transmission:y}),i.name==="body"&&(c=i)}}),M.add(n),b.add(e,"carMaterial",o).onChange(i=>{for(const r of t)i===o.default&&(r.mesh.material=r.material,a.enabled=!1),i===o.physical&&(r.mesh.material=r.physical,a.enabled=!1),i===o.transmission&&(r.mesh.material=r.transmission,a.enabled=!0)}),ze(b,j),De(b,y,a);const F=new O(512,512,{minFilter:k,magFilter:k,colorSpace:d.outputColorSpace,type:B}),S=new O(512,512,{minFilter:k,magFilter:k,colorSpace:d.outputColorSpace,type:B}),g=y;g.buffer=S.texture;let G,v,H;const l={gl:d,scene:s,camera:h};let P;const Z=[{mesh:c,mat:y}],$=new ge(!0);K=()=>{if(a.enabled){g.time=$.getElapsedTime(),a.renderEachMesh?P=t:P=Z;for(let i=0;i<P.length;i++){const r=t[i].mesh;g.buffer===S.texture&&(v=l.gl.toneMapping,G=l.scene.background,H=r.material.side,l.gl.toneMapping=be,a.background&&(l.scene.background=a.background),r.material=U,a.backside&&(l.gl.setRenderTarget(F),l.gl.render(l.scene,l.camera),r.material=g,r.material.buffer=F.texture,r.material.thickness=a.backsideThickness,r.material.side=q),l.gl.setRenderTarget(S),l.gl.render(l.scene,l.camera),r.material=g,r.material.thickness=a.thickness,r.material.side=H,r.material.buffer=S.texture,l.scene.background=G,l.gl.setRenderTarget(null),l.gl.toneMapping=v)}}}}function ze(o,e){const a=o.addFolder("Physical Material");a.addColor(e,"color"),a.addColor(e,"attenuationColor"),a.add(e,"side",{FrontSide:we,BackSide:q,DoubleSide:fe}),a.add(e,"attenuationDistance",0,2),a.add(e,"roughness",0,1),a.add(e,"transmission",0,1),a.add(e,"thickness",0,2),a.add(e,"reflectivity",0,1)}function De(o,e,a){const t=o.addFolder("Transmission Material");t.add(a,"enabled").name("Rendering Enabled").listen(),t.add(a,"backside"),t.add(a,"thickness",0,2),t.add(a,"backsideThickness",0,2),t.addColor(e,"color"),t.addColor(e,"attenuationColor"),t.add(e,"_transmission",0,1),t.add(e,"attenuationDistance",0,2),t.add(e,"roughness",0,1),t.add(e,"chromaticAberration",0,2),t.add(e,"distortion",0,10),t.add(e,"temporalDistortion",0,1),t.add(e,"anisotropicBlur",0,10),t.add(e,"reflectivity",0,1),t.add(a,"renderEachMesh").name("âš  Render Each Mesh separately")}const Ie=new X;function I(){return"#"+Ie.setHSL(Math.random(),.5,.5).getHexString()}export{$e as default};
