import{aT as jn,H as Ge,aJ as Ce,aU as Me,ag as Se,aV as Ke,K as en,L as En,aW as Sn}from"./three.module-N8Yg3gBE.js";/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var q=Uint8Array,_e=Uint16Array,et=Int32Array,mn=new q([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),gn=new q([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),nt=new q([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),yn=function(E,m){for(var I=new _e(31),N=0;N<31;++N)I[N]=m+=1<<E[N-1];for(var U=new et(I[30]),N=1;N<30;++N)for(var Y=I[N];Y<I[N+1];++Y)U[Y]=Y-I[N]<<5|N;return{b:I,r:U}},In=yn(mn,2),Cn=In.b,tt=In.r;Cn[28]=258,tt[258]=28;var rt=yn(gn,0),ot=rt.b,rn=new _e(32768);for(var k=0;k<32768;++k){var he=(k&43690)>>1|(k&21845)<<1;he=(he&52428)>>2|(he&13107)<<2,he=(he&61680)>>4|(he&3855)<<4,rn[k]=((he&65280)>>8|(he&255)<<8)>>1}var ke=function(E,m,I){for(var N=E.length,U=0,Y=new _e(m);U<N;++U)E[U]&&++Y[E[U]-1];var L=new _e(m);for(U=1;U<m;++U)L[U]=L[U-1]+Y[U-1]<<1;var H;if(I){H=new _e(1<<m);var pe=15-m;for(U=0;U<N;++U)if(E[U])for(var me=U<<4|E[U],re=m-E[U],_=L[E[U]-1]++<<re,D=_|(1<<re)-1;_<=D;++_)H[rn[_]>>pe]=me}else for(H=new _e(N),U=0;U<N;++U)E[U]&&(H[U]=rn[L[E[U]-1]++]>>15-E[U]);return H},De=new q(288);for(var k=0;k<144;++k)De[k]=8;for(var k=144;k<256;++k)De[k]=9;for(var k=256;k<280;++k)De[k]=7;for(var k=280;k<288;++k)De[k]=8;var _n=new q(32);for(var k=0;k<32;++k)_n[k]=5;var lt=ke(De,9,1),it=ke(_n,5,1),nn=function(E){for(var m=E[0],I=1;I<E.length;++I)E[I]>m&&(m=E[I]);return m},$=function(E,m,I){var N=m/8|0;return(E[N]|E[N+1]<<8)>>(m&7)&I},tn=function(E,m){var I=m/8|0;return(E[I]|E[I+1]<<8|E[I+2]<<16)>>(m&7)},ct=function(E){return(E+7)/8|0},st=function(E,m,I){return(I==null||I>E.length)&&(I=E.length),new q(E.subarray(m,I))},at=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Q=function(E,m,I){var N=new Error(m||at[E]);if(N.code=E,Error.captureStackTrace&&Error.captureStackTrace(N,Q),!I)throw N;return N},ut=function(E,m,I,N){var U=E.length,Y=0;if(!U||m.f&&!m.l)return I||new q(0);var L=!I,H=L||m.i!=2,pe=m.i;L&&(I=new q(U*3));var me=function(Te){var Ye=I.length;if(Te>Ye){var Oe=new q(Math.max(Ye*2,Te));Oe.set(I),I=Oe}},re=m.f||0,_=m.p||0,D=m.b||0,ie=m.l,Ue=m.d,ge=m.m,ye=m.n,Fe=U*8;do{if(!ie){re=$(E,_,1);var de=$(E,_+1,3);if(_+=3,de)if(de==1)ie=lt,Ue=it,ge=9,ye=5;else if(de==2){var Be=$(E,_,31)+257,Je=$(E,_+10,15)+4,$e=Be+$(E,_+5,31)+1;_+=14;for(var fe=new q($e),Ae=new q(19),P=0;P<Je;++P)Ae[nt[P]]=$(E,_+P*3,7);_+=Je*3;for(var W=nn(Ae),Pe=(1<<W)-1,ve=ke(Ae,W,1),P=0;P<$e;){var He=ve[$(E,_,Pe)];_+=He&15;var J=He>>4;if(J<16)fe[P++]=J;else{var ce=0,we=0;for(J==16?(we=3+$(E,_,3),_+=2,ce=fe[P-1]):J==17?(we=3+$(E,_,7),_+=3):J==18&&(we=11+$(E,_,127),_+=7);we--;)fe[P++]=ce}}var be=fe.subarray(0,Be),V=fe.subarray(Be);ge=nn(be),ye=nn(V),ie=ke(be,ge,1),Ue=ke(V,ye,1)}else Q(1);else{var J=ct(_)+4,Ze=E[J-4]|E[J-3]<<8,Le=J+Ze;if(Le>U){pe&&Q(0);break}H&&me(D+Ze),I.set(E.subarray(J,Le),D),m.b=D+=Ze,m.p=_=Le*8,m.f=re;continue}if(_>Fe){pe&&Q(0);break}}H&&me(D+131072);for(var j=(1<<ge)-1,Ne=(1<<ye)-1,X=_;;X=_){var ce=ie[tn(E,_)&j],ee=ce>>4;if(_+=ce&15,_>Fe){pe&&Q(0);break}if(ce||Q(2),ee<256)I[D++]=ee;else if(ee==256){X=_,ie=null;break}else{var Ie=ee-254;if(ee>264){var P=ee-257,se=mn[P];Ie=$(E,_,(1<<se)-1)+Cn[P],_+=se}var T=Ue[tn(E,_)&Ne],ne=T>>4;T||Q(3),_+=T&15;var V=ot[ne];if(ne>3){var se=gn[ne];V+=tn(E,_)&(1<<se)-1,_+=se}if(_>Fe){pe&&Q(0);break}H&&me(D+131072);var oe=D+Ie;if(D<V){var ze=Y-V,Qe=Math.min(V,oe);for(ze+D<0&&Q(3);D<Qe;++D)I[D]=N[ze+D]}for(;D<oe;++D)I[D]=I[D-V]}}m.l=ie,m.p=X,m.b=D,m.f=re,ie&&(re=1,m.m=ge,m.d=Ue,m.n=ye)}while(!re);return D!=I.length&&L?st(I,0,D):I.subarray(0,D)},ht=new q(0),pt=function(E,m){return((E[0]&15)!=8||E[0]>>4>7||(E[0]<<8|E[1])%31)&&Q(6,"invalid zlib data"),(E[1]>>5&1)==1&&Q(6,"invalid zlib data: "+(E[1]&32?"need":"unexpected")+" dictionary"),(E[1]>>3&4)+2};function qe(E,m){return ut(E.subarray(pt(E),-4),{i:2},m,m)}var ft=typeof TextDecoder<"u"&&new TextDecoder,vt=0;try{ft.decode(ht,{stream:!0}),vt=1}catch{}class Et extends jn{constructor(m){super(m),this.type=Ge,this.outputFormat=Ce}parse(m){const fe=Math.pow(2.7182818,2.2);function Ae(e,n){let t=0;for(let l=0;l<65536;++l)(l==0||e[l>>3]&1<<(l&7))&&(n[t++]=l);const o=t-1;for(;t<65536;)n[t++]=0;return o}function P(e){for(let n=0;n<16384;n++)e[n]={},e[n].len=0,e[n].lit=0,e[n].p=null}const W={l:0,c:0,lc:0};function Pe(e,n,t,o,l){for(;t<e;)n=n<<8|pn(o,l),t+=8;t-=e,W.l=n>>t&(1<<e)-1,W.c=n,W.lc=t}const ve=new Array(59);function He(e){for(let t=0;t<=58;++t)ve[t]=0;for(let t=0;t<65537;++t)ve[e[t]]+=1;let n=0;for(let t=58;t>0;--t){const o=n+ve[t]>>1;ve[t]=n,n=o}for(let t=0;t<65537;++t){const o=e[t];o>0&&(e[t]=o|ve[o]++<<6)}}function ce(e,n,t,o,l,a){const r=n;let u=0,c=0;for(;o<=l;o++){if(r.value-n.value>t)return!1;Pe(6,u,c,e,r);const i=W.l;if(u=W.c,c=W.lc,a[o]=i,i==63){if(r.value-n.value>t)throw new Error("Something wrong with hufUnpackEncTable");Pe(8,u,c,e,r);let s=W.l+6;if(u=W.c,c=W.lc,o+s>l+1)throw new Error("Something wrong with hufUnpackEncTable");for(;s--;)a[o++]=0;o--}else if(i>=59){let s=i-59+2;if(o+s>l+1)throw new Error("Something wrong with hufUnpackEncTable");for(;s--;)a[o++]=0;o--}}He(a)}function we(e){return e&63}function be(e){return e>>6}function V(e,n,t,o){for(;n<=t;n++){const l=be(e[n]),a=we(e[n]);if(l>>a)throw new Error("Invalid table entry");if(a>14){const r=o[l>>a-14];if(r.len)throw new Error("Invalid table entry");if(r.lit++,r.p){const u=r.p;r.p=new Array(r.lit);for(let c=0;c<r.lit-1;++c)r.p[c]=u[c]}else r.p=new Array(1);r.p[r.lit-1]=n}else if(a){let r=0;for(let u=1<<14-a;u>0;u--){const c=o[(l<<14-a)+r];if(c.len||c.p)throw new Error("Invalid table entry");c.len=a,c.lit=n,r++}}}return!0}const j={c:0,lc:0};function Ne(e,n,t,o){e=e<<8|pn(t,o),n+=8,j.c=e,j.lc=n}const X={c:0,lc:0};function ee(e,n,t,o,l,a,r,u,c){if(e==n){o<8&&(Ne(t,o,l,a),t=j.c,o=j.lc),o-=8;let i=t>>o;if(i=new Uint8Array([i])[0],u.value+i>c)return!1;const s=r[u.value-1];for(;i-- >0;)r[u.value++]=s}else if(u.value<c)r[u.value++]=e;else return!1;X.c=t,X.lc=o}function Ie(e){return e&65535}function se(e){const n=Ie(e);return n>32767?n-65536:n}const T={a:0,b:0};function ne(e,n){const t=se(e),l=se(n),a=t+(l&1)+(l>>1),r=a,u=a-l;T.a=r,T.b=u}function oe(e,n){const t=Ie(e),o=Ie(n),l=t-(o>>1)&65535,a=o+l-32768&65535;T.a=a,T.b=l}function ze(e,n,t,o,l,a,r){const u=r<16384,c=t>l?l:t;let i=1,s,p;for(;i<=c;)i<<=1;for(i>>=1,s=i,i>>=1;i>=1;){p=0;const h=p+a*(l-s),v=a*i,g=a*s,f=o*i,S=o*s;let y,b,x,d;for(;p<=h;p+=g){let O=p;const C=p+o*(t-s);for(;O<=C;O+=S){const F=O+f,Z=O+v,M=Z+f;u?(ne(e[O+n],e[Z+n]),y=T.a,x=T.b,ne(e[F+n],e[M+n]),b=T.a,d=T.b,ne(y,b),e[O+n]=T.a,e[F+n]=T.b,ne(x,d),e[Z+n]=T.a,e[M+n]=T.b):(oe(e[O+n],e[Z+n]),y=T.a,x=T.b,oe(e[F+n],e[M+n]),b=T.a,d=T.b,oe(y,b),e[O+n]=T.a,e[F+n]=T.b,oe(x,d),e[Z+n]=T.a,e[M+n]=T.b)}if(t&i){const F=O+v;u?ne(e[O+n],e[F+n]):oe(e[O+n],e[F+n]),y=T.a,e[F+n]=T.b,e[O+n]=y}}if(l&i){let O=p;const C=p+o*(t-s);for(;O<=C;O+=S){const F=O+f;u?ne(e[O+n],e[F+n]):oe(e[O+n],e[F+n]),y=T.a,e[F+n]=T.b,e[O+n]=y}}s=i,i>>=1}return p}function Qe(e,n,t,o,l,a,r,u,c){let i=0,s=0;const p=r,h=Math.trunc(o.value+(l+7)/8);for(;o.value<h;)for(Ne(i,s,t,o),i=j.c,s=j.lc;s>=14;){const g=i>>s-14&16383,f=n[g];if(f.len)s-=f.len,ee(f.lit,a,i,s,t,o,u,c,p),i=X.c,s=X.lc;else{if(!f.p)throw new Error("hufDecode issues");let S;for(S=0;S<f.lit;S++){const y=we(e[f.p[S]]);for(;s<y&&o.value<h;)Ne(i,s,t,o),i=j.c,s=j.lc;if(s>=y&&be(e[f.p[S]])==(i>>s-y&(1<<y)-1)){s-=y,ee(f.p[S],a,i,s,t,o,u,c,p),i=X.c,s=X.lc;break}}if(S==f.lit)throw new Error("hufDecode issues")}}const v=8-l&7;for(i>>=v,s-=v;s>0;){const g=n[i<<14-s&16383];if(g.len)s-=g.len,ee(g.lit,a,i,s,t,o,u,c,p),i=X.c,s=X.lc;else throw new Error("hufDecode issues")}return!0}function Te(e,n,t,o,l,a){const r={value:0},u=t.value,c=K(n,t),i=K(n,t);t.value+=4;const s=K(n,t);if(t.value+=4,c<0||c>=65537||i<0||i>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const p=new Array(65537),h=new Array(16384);P(h);const v=o-(t.value-u);if(ce(e,t,v,c,i,p),s>8*(o-(t.value-u)))throw new Error("Something wrong with hufUncompress");V(p,c,i,h),Qe(p,h,e,t,s,i,a,l,r)}function Ye(e,n,t){for(let o=0;o<t;++o)n[o]=e[n[o]]}function Oe(e){for(let n=1;n<e.length;n++){const t=e[n-1]+e[n]-128;e[n]=t}}function on(e,n){let t=0,o=Math.floor((e.length+1)/2),l=0;const a=e.length-1;for(;!(l>a||(n[l++]=e[t++],l>a));)n[l++]=e[o++]}function ln(e){let n=e.byteLength;const t=new Array;let o=0;const l=new DataView(e);for(;n>0;){const a=l.getInt8(o++);if(a<0){const r=-a;n-=r+1;for(let u=0;u<r;u++)t.push(l.getUint8(o++))}else{const r=a;n-=2;const u=l.getUint8(o++);for(let c=0;c<r+1;c++)t.push(u)}}return t}function Un(e,n,t,o,l,a){let r=new DataView(a.buffer);const u=t[e.idx[0]].width,c=t[e.idx[0]].height,i=3,s=Math.floor(u/8),p=Math.ceil(u/8),h=Math.ceil(c/8),v=u-(p-1)*8,g=c-(h-1)*8,f={value:0},S=new Array(i),y=new Array(i),b=new Array(i),x=new Array(i),d=new Array(i);for(let C=0;C<i;++C)d[C]=n[e.idx[C]],S[C]=C<1?0:S[C-1]+p*h,y[C]=new Float32Array(64),b[C]=new Uint16Array(64),x[C]=new Uint16Array(p*64);for(let C=0;C<h;++C){let F=8;C==h-1&&(F=g);let Z=8;for(let A=0;A<p;++A){A==p-1&&(Z=v);for(let R=0;R<i;++R)b[R].fill(0),b[R][0]=l[S[R]++],cn(f,o,b[R]),sn(b[R],y[R]),an(y[R]);bn(y);for(let R=0;R<i;++R)un(y[R],x[R],A*64)}let M=0;for(let A=0;A<i;++A){const R=t[e.idx[A]].type;for(let le=8*C;le<8*C+F;++le){M=d[A][le];for(let Re=0;Re<s;++Re){const te=Re*64+(le&7)*8;r.setUint16(M+0*R,x[A][te+0],!0),r.setUint16(M+2*R,x[A][te+1],!0),r.setUint16(M+4*R,x[A][te+2],!0),r.setUint16(M+6*R,x[A][te+3],!0),r.setUint16(M+8*R,x[A][te+4],!0),r.setUint16(M+10*R,x[A][te+5],!0),r.setUint16(M+12*R,x[A][te+6],!0),r.setUint16(M+14*R,x[A][te+7],!0),M+=16*R}}if(s!=p)for(let le=8*C;le<8*C+F;++le){const Re=d[A][le]+8*s*2*R,te=s*64+(le&7)*8;for(let Xe=0;Xe<Z;++Xe)r.setUint16(Re+Xe*2*R,x[A][te+Xe],!0)}}}const O=new Uint16Array(u);r=new DataView(a.buffer);for(let C=0;C<i;++C){t[e.idx[C]].decoded=!0;const F=t[e.idx[C]].type;if(t[C].type==2)for(let Z=0;Z<c;++Z){const M=d[C][Z];for(let A=0;A<u;++A)O[A]=r.getUint16(M+A*2*F,!0);for(let A=0;A<u;++A)r.setFloat32(M+A*2*F,w(O[A]),!0)}}}function An(e,n,t,o,l,a){const r=new DataView(a.buffer),u=t[e],c=u.width,i=u.height,s=Math.ceil(c/8),p=Math.ceil(i/8),h=Math.floor(c/8),v=c-(s-1)*8,g=i-(p-1)*8,f={value:0};let S=0;const y=new Float32Array(64),b=new Uint16Array(64),x=new Uint16Array(s*64);for(let d=0;d<p;++d){let O=8;d==p-1&&(O=g);for(let C=0;C<s;++C)b.fill(0),b[0]=l[S++],cn(f,o,b),sn(b,y),an(y),un(y,x,C*64);for(let C=8*d;C<8*d+O;++C){let F=n[e][C];for(let Z=0;Z<h;++Z){const M=Z*64+(C&7)*8;for(let A=0;A<8;++A)r.setUint16(F+A*2*u.type,x[M+A],!0);F+=16*u.type}if(s!=h){const Z=h*64+(C&7)*8;for(let M=0;M<v;++M)r.setUint16(F+M*2*u.type,x[Z+M],!0)}}}u.decoded=!0}function cn(e,n,t){let o,l=1;for(;l<64;)o=n[e.value],o==65280?l=64:o>>8==255?l+=o&255:(t[l]=o,l++),e.value++}function sn(e,n){n[0]=w(e[0]),n[1]=w(e[1]),n[2]=w(e[5]),n[3]=w(e[6]),n[4]=w(e[14]),n[5]=w(e[15]),n[6]=w(e[27]),n[7]=w(e[28]),n[8]=w(e[2]),n[9]=w(e[4]),n[10]=w(e[7]),n[11]=w(e[13]),n[12]=w(e[16]),n[13]=w(e[26]),n[14]=w(e[29]),n[15]=w(e[42]),n[16]=w(e[3]),n[17]=w(e[8]),n[18]=w(e[12]),n[19]=w(e[17]),n[20]=w(e[25]),n[21]=w(e[30]),n[22]=w(e[41]),n[23]=w(e[43]),n[24]=w(e[9]),n[25]=w(e[11]),n[26]=w(e[18]),n[27]=w(e[24]),n[28]=w(e[31]),n[29]=w(e[40]),n[30]=w(e[44]),n[31]=w(e[53]),n[32]=w(e[10]),n[33]=w(e[19]),n[34]=w(e[23]),n[35]=w(e[32]),n[36]=w(e[39]),n[37]=w(e[45]),n[38]=w(e[52]),n[39]=w(e[54]),n[40]=w(e[20]),n[41]=w(e[22]),n[42]=w(e[33]),n[43]=w(e[38]),n[44]=w(e[46]),n[45]=w(e[51]),n[46]=w(e[55]),n[47]=w(e[60]),n[48]=w(e[21]),n[49]=w(e[34]),n[50]=w(e[37]),n[51]=w(e[47]),n[52]=w(e[50]),n[53]=w(e[56]),n[54]=w(e[59]),n[55]=w(e[61]),n[56]=w(e[35]),n[57]=w(e[36]),n[58]=w(e[48]),n[59]=w(e[49]),n[60]=w(e[57]),n[61]=w(e[58]),n[62]=w(e[62]),n[63]=w(e[63])}function an(e){const n=.5*Math.cos(.7853975),t=.5*Math.cos(3.14159/16),o=.5*Math.cos(3.14159/8),l=.5*Math.cos(3*3.14159/16),a=.5*Math.cos(5*3.14159/16),r=.5*Math.cos(3*3.14159/8),u=.5*Math.cos(7*3.14159/16),c=new Array(4),i=new Array(4),s=new Array(4),p=new Array(4);for(let h=0;h<8;++h){const v=h*8;c[0]=o*e[v+2],c[1]=r*e[v+2],c[2]=o*e[v+6],c[3]=r*e[v+6],i[0]=t*e[v+1]+l*e[v+3]+a*e[v+5]+u*e[v+7],i[1]=l*e[v+1]-u*e[v+3]-t*e[v+5]-a*e[v+7],i[2]=a*e[v+1]-t*e[v+3]+u*e[v+5]+l*e[v+7],i[3]=u*e[v+1]-a*e[v+3]+l*e[v+5]-t*e[v+7],s[0]=n*(e[v+0]+e[v+4]),s[3]=n*(e[v+0]-e[v+4]),s[1]=c[0]+c[3],s[2]=c[1]-c[2],p[0]=s[0]+s[1],p[1]=s[3]+s[2],p[2]=s[3]-s[2],p[3]=s[0]-s[1],e[v+0]=p[0]+i[0],e[v+1]=p[1]+i[1],e[v+2]=p[2]+i[2],e[v+3]=p[3]+i[3],e[v+4]=p[3]-i[3],e[v+5]=p[2]-i[2],e[v+6]=p[1]-i[1],e[v+7]=p[0]-i[0]}for(let h=0;h<8;++h)c[0]=o*e[16+h],c[1]=r*e[16+h],c[2]=o*e[48+h],c[3]=r*e[48+h],i[0]=t*e[8+h]+l*e[24+h]+a*e[40+h]+u*e[56+h],i[1]=l*e[8+h]-u*e[24+h]-t*e[40+h]-a*e[56+h],i[2]=a*e[8+h]-t*e[24+h]+u*e[40+h]+l*e[56+h],i[3]=u*e[8+h]-a*e[24+h]+l*e[40+h]-t*e[56+h],s[0]=n*(e[h]+e[32+h]),s[3]=n*(e[h]-e[32+h]),s[1]=c[0]+c[3],s[2]=c[1]-c[2],p[0]=s[0]+s[1],p[1]=s[3]+s[2],p[2]=s[3]-s[2],p[3]=s[0]-s[1],e[0+h]=p[0]+i[0],e[8+h]=p[1]+i[1],e[16+h]=p[2]+i[2],e[24+h]=p[3]+i[3],e[32+h]=p[3]-i[3],e[40+h]=p[2]-i[2],e[48+h]=p[1]-i[1],e[56+h]=p[0]-i[0]}function bn(e){for(let n=0;n<64;++n){const t=e[0][n],o=e[1][n],l=e[2][n];e[0][n]=t+1.5747*l,e[1][n]=t-.1873*o-.4682*l,e[2][n]=t+1.8556*o}}function un(e,n,t){for(let o=0;o<64;++o)n[t+o]=Sn.toHalfFloat(Nn(e[o]))}function Nn(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(fe,Math.abs(e)-1)}function Ve(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function Tn(e){const n=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),t=new Uint8Array(ln(n)),o=new Uint8Array(t.length);return Oe(t),on(t,o),new DataView(o.buffer)}function je(e){const n=e.array.slice(e.offset.value,e.offset.value+e.size),t=qe(n),o=new Uint8Array(t.length);return Oe(t),on(t,o),new DataView(o.buffer)}function On(e){const n=e.viewer,t={value:e.offset.value},o=new Uint16Array(e.columns*e.lines*(e.inputChannels.length*e.type)),l=new Uint8Array(8192);let a=0;const r=new Array(e.inputChannels.length);for(let g=0,f=e.inputChannels.length;g<f;g++)r[g]={},r[g].start=a,r[g].end=r[g].start,r[g].nx=e.columns,r[g].ny=e.lines,r[g].size=e.type,a+=r[g].nx*r[g].ny*r[g].size;const u=xe(n,t),c=xe(n,t);if(c>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(u<=c)for(let g=0;g<c-u+1;g++)l[g+u]=ae(n,t);const i=new Uint16Array(65536),s=Ae(l,i),p=K(n,t);Te(e.array,n,t,p,o,a);for(let g=0;g<e.inputChannels.length;++g){const f=r[g];for(let S=0;S<r[g].size;++S)ze(o,f.start+S,f.nx,f.size,f.ny,f.nx*f.size,s)}Ye(i,o,a);let h=0;const v=new Uint8Array(o.buffer.byteLength);for(let g=0;g<e.lines;g++)for(let f=0;f<e.inputChannels.length;f++){const S=r[f],y=S.nx*S.size,b=new Uint8Array(o.buffer,S.end*2,y*2);v.set(b,h),h+=y*2,S.end+=y}return new DataView(v.buffer)}function xn(e){const n=e.array.slice(e.offset.value,e.offset.value+e.size),t=qe(n),o=e.inputChannels.length*e.lines*e.columns*e.totalBytes,l=new ArrayBuffer(o),a=new DataView(l);let r=0,u=0;const c=new Array(4);for(let i=0;i<e.lines;i++)for(let s=0;s<e.inputChannels.length;s++){let p=0;switch(e.inputChannels[s].pixelType){case 1:c[0]=r,c[1]=c[0]+e.columns,r=c[1]+e.columns;for(let v=0;v<e.columns;++v){const g=t[c[0]++]<<8|t[c[1]++];p+=g,a.setUint16(u,p,!0),u+=2}break;case 2:c[0]=r,c[1]=c[0]+e.columns,c[2]=c[1]+e.columns,r=c[2]+e.columns;for(let v=0;v<e.columns;++v){const g=t[c[0]++]<<24|t[c[1]++]<<16|t[c[2]++]<<8;p+=g,a.setUint32(u,p,!0),u+=4}break}}return a}function hn(e){const n=e.viewer,t={value:e.offset.value},o=new Uint8Array(e.columns*e.lines*(e.inputChannels.length*e.type*2)),l={version:z(n,t),unknownUncompressedSize:z(n,t),unknownCompressedSize:z(n,t),acCompressedSize:z(n,t),dcCompressedSize:z(n,t),rleCompressedSize:z(n,t),rleUncompressedSize:z(n,t),rleRawSize:z(n,t),totalAcUncompressedCount:z(n,t),totalDcUncompressedCount:z(n,t),acCompression:z(n,t)};if(l.version<2)throw new Error("EXRLoader.parse: "+Ee.compression+" version "+l.version+" is unsupported");const a=new Array;let r=xe(n,t)-2;for(;r>0;){const f=We(n.buffer,t),S=ae(n,t),y=S>>2&3,b=(S>>4)-1,x=new Int8Array([b])[0],d=ae(n,t);a.push({name:f,index:x,type:d,compression:y}),r-=f.length+3}const u=Ee.channels,c=new Array(e.inputChannels.length);for(let f=0;f<e.inputChannels.length;++f){const S=c[f]={},y=u[f];S.name=y.name,S.compression=0,S.decoded=!1,S.type=y.pixelType,S.pLinear=y.pLinear,S.width=e.columns,S.height=e.lines}const i={idx:new Array(3)};for(let f=0;f<e.inputChannels.length;++f){const S=c[f];for(let y=0;y<a.length;++y){const b=a[y];S.name==b.name&&(S.compression=b.compression,b.index>=0&&(i.idx[b.index]=f),S.offset=f)}}let s,p,h;if(l.acCompressedSize>0)switch(l.acCompression){case 0:s=new Uint16Array(l.totalAcUncompressedCount),Te(e.array,n,t,l.acCompressedSize,s,l.totalAcUncompressedCount);break;case 1:const f=e.array.slice(t.value,t.value+l.totalAcUncompressedCount),S=qe(f);s=new Uint16Array(S.buffer),t.value+=l.totalAcUncompressedCount;break}if(l.dcCompressedSize>0){const f={array:e.array,offset:t,size:l.dcCompressedSize};p=new Uint16Array(je(f).buffer),t.value+=l.dcCompressedSize}if(l.rleRawSize>0){const f=e.array.slice(t.value,t.value+l.rleCompressedSize),S=qe(f);h=ln(S.buffer),t.value+=l.rleCompressedSize}let v=0;const g=new Array(c.length);for(let f=0;f<g.length;++f)g[f]=new Array;for(let f=0;f<e.lines;++f)for(let S=0;S<c.length;++S)g[S].push(v),v+=c[S].width*e.type*2;i.idx[0]!==void 0&&c[i.idx[0]]&&Un(i,g,c,s,p,o);for(let f=0;f<c.length;++f){const S=c[f];if(!S.decoded)switch(S.compression){case 2:let y=0,b=0;for(let x=0;x<e.lines;++x){let d=g[f][y];for(let O=0;O<S.width;++O){for(let C=0;C<2*S.type;++C)o[d++]=h[b+C*S.width*S.height];b++}y++}break;case 1:An(f,g,c,s,p,o);break;default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(o.buffer)}function We(e,n){const t=new Uint8Array(e);let o=0;for(;t[n.value+o]!=0;)o+=1;const l=new TextDecoder().decode(t.slice(n.value,n.value+o));return n.value=n.value+o+1,l}function Rn(e,n,t){const o=new TextDecoder().decode(new Uint8Array(e).slice(n.value,n.value+t));return n.value=n.value+t,o}function Mn(e,n){const t=G(e,n),o=K(e,n);return[t,o]}function kn(e,n){const t=K(e,n),o=K(e,n);return[t,o]}function G(e,n){const t=e.getInt32(n.value,!0);return n.value=n.value+4,t}function K(e,n){const t=e.getUint32(n.value,!0);return n.value=n.value+4,t}function pn(e,n){const t=e[n.value];return n.value=n.value+1,t}function ae(e,n){const t=e.getUint8(n.value);return n.value=n.value+1,t}const z=function(e,n){let t;return"getBigInt64"in DataView.prototype?t=Number(e.getBigInt64(n.value,!0)):t=e.getUint32(n.value+4,!0)+Number(e.getUint32(n.value,!0)<<32),n.value+=8,t};function B(e,n){const t=e.getFloat32(n.value,!0);return n.value+=4,t}function Dn(e,n){return Sn.toHalfFloat(B(e,n))}function w(e){const n=(e&31744)>>10,t=e&1023;return(e>>15?-1:1)*(n?n===31?t?NaN:1/0:Math.pow(2,n-15)*(1+t/1024):6103515625e-14*(t/1024))}function xe(e,n){const t=e.getUint16(n.value,!0);return n.value+=2,t}function Fn(e,n){return w(xe(e,n))}function dn(e,n,t,o){const l=t.value,a=[];for(;t.value<l+o-1;){const r=We(n,t),u=G(e,t),c=ae(e,t);t.value+=3;const i=G(e,t),s=G(e,t);a.push({name:r,pixelType:u,pLinear:c,xSampling:i,ySampling:s})}return t.value+=1,a}function Zn(e,n){const t=B(e,n),o=B(e,n),l=B(e,n),a=B(e,n),r=B(e,n),u=B(e,n),c=B(e,n),i=B(e,n);return{redX:t,redY:o,greenX:l,greenY:a,blueX:r,blueY:u,whiteX:c,whiteY:i}}function Ln(e,n){const t=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],o=ae(e,n);return t[o]}function Bn(e,n){const t=G(e,n),o=G(e,n),l=G(e,n),a=G(e,n);return{xMin:t,yMin:o,xMax:l,yMax:a}}function Pn(e,n){const t=["INCREASING_Y","DECREASING_Y","RANDOM_Y"],o=ae(e,n);return t[o]}function Hn(e,n){const t=["ENVMAP_LATLONG","ENVMAP_CUBE"],o=ae(e,n);return t[o]}function zn(e,n){const t=["ONE_LEVEL","MIPMAP_LEVELS","RIPMAP_LEVELS"],o=["ROUND_DOWN","ROUND_UP"],l=K(e,n),a=K(e,n),r=ae(e,n);return{xSize:l,ySize:a,levelMode:t[r&15],roundingMode:o[r>>4]}}function Yn(e,n){const t=B(e,n),o=B(e,n);return[t,o]}function Wn(e,n){const t=B(e,n),o=B(e,n),l=B(e,n);return[t,o,l]}function Xn(e,n,t,o,l){if(o==="string"||o==="stringvector"||o==="iccProfile")return Rn(n,t,l);if(o==="chlist")return dn(e,n,t,l);if(o==="chromaticities")return Zn(e,t);if(o==="compression")return Ln(e,t);if(o==="box2i")return Bn(e,t);if(o==="envmap")return Hn(e,t);if(o==="tiledesc")return zn(e,t);if(o==="lineOrder")return Pn(e,t);if(o==="float")return B(e,t);if(o==="v2f")return Yn(e,t);if(o==="v3f")return Wn(e,t);if(o==="int")return G(e,t);if(o==="rational")return Mn(e,t);if(o==="timecode")return kn(e,t);if(o==="preview")return t.value+=l,"skipped";t.value+=l}function Gn(e,n){const t=Math.log2(e);return n=="ROUND_DOWN"?Math.floor(t):Math.ceil(t)}function Kn(e,n,t){let o=0;switch(e.levelMode){case"ONE_LEVEL":o=1;break;case"MIPMAP_LEVELS":o=Gn(Math.max(n,t),e.roundingMode)+1;break;case"RIPMAP_LEVELS":throw new Error("THREE.EXRLoader: RIPMAP_LEVELS tiles currently unsupported.")}return o}function fn(e,n,t,o){const l=new Array(e);for(let a=0;a<e;a++){const r=1<<a;let u=n/r|0;o=="ROUND_UP"&&u*r<n&&(u+=1);const c=Math.max(u,1);l[a]=(c+t-1)/t|0}return l}function qn(){const e=this,n=e.offset,t={value:0};for(let o=0;o<e.tileCount;o++){const l=G(e.viewer,n),a=G(e.viewer,n);n.value+=8,e.size=K(e.viewer,n);const r=l*e.blockWidth,u=a*e.blockHeight;e.columns=r+e.blockWidth>e.width?e.width-r:e.blockWidth,e.lines=u+e.blockHeight>e.height?e.height-u:e.blockHeight;const c=e.columns*e.totalBytes,s=e.size<e.lines*c?e.uncompress(e):Ve(e);n.value+=e.size;for(let p=0;p<e.lines;p++){const h=p*e.columns*e.totalBytes;for(let v=0;v<e.inputChannels.length;v++){const g=Ee.channels[v].name,f=e.channelByteOffsets[g]*e.columns,S=e.decodeChannels[g];if(S===void 0)continue;t.value=h+f;const y=(e.height-(1+u+p))*e.outLineWidth;for(let b=0;b<e.columns;b++){const x=y+(b+r)*e.outputChannels+S;e.byteArray[x]=e.getter(s,t)}}}}}function Jn(){const e=this,n=e.offset,t={value:0};for(let o=0;o<e.height/e.blockHeight;o++){const l=G(e.viewer,n)-Ee.dataWindow.yMin;e.size=K(e.viewer,n),e.lines=l+e.blockHeight>e.height?e.height-l:e.blockHeight;const a=e.columns*e.totalBytes,u=e.size<e.lines*a?e.uncompress(e):Ve(e);n.value+=e.size;for(let c=0;c<e.blockHeight;c++){const i=o*e.blockHeight,s=c+e.scanOrder(i);if(s>=e.height)continue;const p=c*a,h=(e.height-1-s)*e.outLineWidth;for(let v=0;v<e.inputChannels.length;v++){const g=Ee.channels[v].name,f=e.channelByteOffsets[g]*e.columns,S=e.decodeChannels[g];if(S!==void 0){t.value=p+f;for(let y=0;y<e.columns;y++){const b=h+y*e.outputChannels+S;e.byteArray[b]=e.getter(u,t)}}}}}}function $n(e,n,t){const o={};if(e.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");o.version=e.getUint8(4);const l=e.getUint8(5);o.spec={singleTile:!!(l&2),longName:!!(l&4),deepFormat:!!(l&8),multiPart:!!(l&16)},t.value=8;let a=!0;for(;a;){const r=We(n,t);if(r==="")a=!1;else{const u=We(n,t),c=K(e,t),i=Xn(e,n,t,u,c);i===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${u}'.`):o[r]=i}}if((l&-7)!=0)throw console.error("THREE.EXRHeader:",o),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return o}function Qn(e,n,t,o,l,a){const r={size:0,viewer:n,array:t,offset:o,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,inputChannels:e.channels,channelByteOffsets:{},shouldExpand:!1,scanOrder:null,totalBytes:null,columns:null,lines:null,type:null,uncompress:null,getter:null,format:null,colorSpace:Se};switch(e.compression){case"NO_COMPRESSION":r.blockHeight=1,r.uncompress=Ve;break;case"RLE_COMPRESSION":r.blockHeight=1,r.uncompress=Tn;break;case"ZIPS_COMPRESSION":r.blockHeight=1,r.uncompress=je;break;case"ZIP_COMPRESSION":r.blockHeight=16,r.uncompress=je;break;case"PIZ_COMPRESSION":r.blockHeight=32,r.uncompress=On;break;case"PXR24_COMPRESSION":r.blockHeight=16,r.uncompress=xn;break;case"DWAA_COMPRESSION":r.blockHeight=32,r.uncompress=hn;break;case"DWAB_COMPRESSION":r.blockHeight=256,r.uncompress=hn;break;default:throw new Error("EXRLoader.parse: "+e.compression+" is unsupported")}const u={};for(const h of e.channels)switch(h.name){case"Y":case"R":case"G":case"B":case"A":u[h.name]=!0,r.type=h.pixelType}let c=!1,i=!1;if(u.R&&u.G&&u.B)r.outputChannels=4;else if(u.Y)r.outputChannels=1;else throw new Error("EXRLoader.parse: file contains unsupported data channels.");switch(r.outputChannels){case 4:a==Ce?(c=!u.A,r.format=Ce,r.colorSpace=Se,r.outputChannels=4,r.decodeChannels={R:0,G:1,B:2,A:3}):a==Me?(r.format=Me,r.colorSpace=Se,r.outputChannels=2,r.decodeChannels={R:0,G:1}):a==Ke?(r.format=Ke,r.colorSpace=Se,r.outputChannels=1,r.decodeChannels={R:0}):i=!0;break;case 1:a==Ce?(c=!0,r.format=Ce,r.colorSpace=Se,r.outputChannels=4,r.shouldExpand=!0,r.decodeChannels={Y:0}):a==Me?(r.format=Me,r.colorSpace=Se,r.outputChannels=2,r.shouldExpand=!0,r.decodeChannels={Y:0}):a==Ke?(r.format=Ke,r.colorSpace=Se,r.outputChannels=1,r.decodeChannels={Y:0}):i=!0;break;default:i=!0}if(i)throw new Error("EXRLoader.parse: invalid output format for specified file.");if(r.type==1)switch(l){case en:r.getter=Fn;break;case Ge:r.getter=xe;break}else if(r.type==2)switch(l){case en:r.getter=B;break;case Ge:r.getter=Dn}else throw new Error("EXRLoader.parse: unsupported pixelType "+r.type+" for "+e.compression+".");r.columns=r.width;const s=r.width*r.height*r.outputChannels;switch(l){case en:r.byteArray=new Float32Array(s),c&&r.byteArray.fill(1,0,s);break;case Ge:r.byteArray=new Uint16Array(s),c&&r.byteArray.fill(15360,0,s);break;default:console.error("THREE.EXRLoader: unsupported type: ",l);break}let p=0;for(const h of e.channels)r.decodeChannels[h.name]!==void 0&&(r.channelByteOffsets[h.name]=p),p+=h.pixelType*2;if(r.totalBytes=p,r.outLineWidth=r.width*r.outputChannels,e.lineOrder==="INCREASING_Y"?r.scanOrder=h=>h:r.scanOrder=h=>r.height-1-h,e.spec.singleTile){r.blockHeight=e.tiles.ySize,r.blockWidth=e.tiles.xSize;const h=Kn(e.tiles,r.width,r.height),v=fn(h,r.width,e.tiles.xSize,e.tiles.roundingMode),g=fn(h,r.height,e.tiles.ySize,e.tiles.roundingMode);r.tileCount=v[0]*g[0];for(let f=0;f<h;f++)for(let S=0;S<g[f];S++)for(let y=0;y<v[f];y++)z(n,o);r.decode=qn.bind(r)}else{r.blockWidth=r.width;const h=Math.ceil(r.height/r.blockHeight);for(let v=0;v<h;v++)z(n,o);r.decode=Jn.bind(r)}return r}const vn={value:0},wn=new DataView(m),Vn=new Uint8Array(m),Ee=$n(wn,m,vn),ue=Qn(Ee,wn,Vn,vn,this.type,this.outputFormat);if(ue.decode(),ue.shouldExpand){const e=ue.byteArray;if(this.outputFormat==Ce)for(let n=0;n<e.length;n+=4)e[n+2]=e[n+1]=e[n];else if(this.outputFormat==Me)for(let n=0;n<e.length;n+=2)e[n+1]=e[n]}return{header:Ee,width:ue.width,height:ue.height,data:ue.byteArray,format:ue.format,colorSpace:ue.colorSpace,type:this.type}}setDataType(m){return this.type=m,this}setOutputFormat(m){return this.outputFormat=m,this}load(m,I,N,U){function Y(L,H){L.colorSpace=H.colorSpace,L.minFilter=En,L.magFilter=En,L.generateMipmaps=!1,L.flipY=!1,I&&I(L,H)}return super.load(m,Y,N,U)}}export{Et as E};
