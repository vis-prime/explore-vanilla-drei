import{G as Q,e as dt,aQ as N,aR as J,aJ as ct,v as A,a2 as et,aT as k,aB as lt,C as X,a1 as pt,S as ut,W as ht,V as mt,a as ft,aV as gt,b as wt,c as yt,O as Ct,d as bt,R as vt,q as xt,s as z,t as H,T as Mt,r as j,i as At,n as St,o as Lt}from"./OrbitControls-R0lqBEeo.js";import{T as Dt}from"./TransformControls-C9PpcTYI.js";import{T as Ot,E as Ft,u as Rt}from"./tween.esm-DFB-vPb4.js";import{B as Et}from"./BG_ENV-DvPFx4cR.js";import"./EXRLoader-CueWY_mu.js";import"./RGBELoader-C-6F00h6.js";import"./GroundProjectedSkybox-C8DAfX2s.js";import"./HDRI_LIST-DJCqOZOR.js";const V=(n,t)=>{"updateRanges"in n?n.updateRanges[0]=t:n.updateRange=t},It="https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png",Y=new et,U=new A,W=new k,K=new A,Z=new k,T=new A,Tt=n=>class extends n{constructor(){super();const t=parseInt(pt.replace(/\D+/g,""))>=154?"opaque_fragment":"output_fragment";this.onBeforeCompile=s=>{s.vertexShader=`attribute float cloudOpacity;
               varying float vOpacity;
              `+s.vertexShader.replace("#include <fog_vertex>",`#include <fog_vertex>
                 vOpacity = cloudOpacity;
                `),s.fragmentShader=`varying float vOpacity;
              `+s.fragmentShader.replace(`#include <${t}>`,`#include <${t}>
                 gl_FragColor = vec4(outgoingLight, diffuseColor.a * vOpacity);
                `)}}};class Pt extends Q{constructor({limit:t=200,range:s,material:i=lt,texture:v,frustumCulled:x=!0}={}){super(),this.name="Clouds",this.ref=this;const e=this,a=new dt(1,1),L=new Float32Array(Array.from({length:t},()=>1)),F=new Float32Array(Array.from({length:t},()=>[1,1,1]).flat()),S=new N(L,1);S.setUsage(J),a.setAttribute("cloudOpacity",S);const D=Tt(i),h=new D;h.map=v,h.transparent=!0,h.depthWrite=!1,h.needsUpdate=!0,this.cloudMaterial=h,this.instance=new ct(a,h,t);const d=this.instance;d.matrixAutoUpdate=!1,d.frustumCulled=x,d.instanceColor=new N(F,3),d.instanceColor.setUsage(J),e.add(d);const y=[],M=()=>{const p=y.length;let G=0;for(let C=0;C<this.ref.children.length;C++){const m=this.ref.children[C];m.cloudStateArray&&(G+=m.cloudStateArray.length)}if(p===G)return y;y.length=0;for(let C=0;C<this.ref.children.length;C++){const m=this.ref.children[C];m.cloudStateArray&&y.push(...m.cloudStateArray)}return o(),y},o=()=>{const p=Math.min(t,s!==void 0?s:t,y.length);d.count=p,V(d.instanceMatrix,{offset:0,count:p*16}),d.instanceColor&&V(d.instanceColor,{offset:0,count:p*3}),V(d.geometry.attributes.cloudOpacity,{offset:0,count:p})};let P=0,c=0,r;const R=new k,E=new A(0,0,1),I=new A;this.update=(p,G,C)=>{P=G,Y.copy(d.matrixWorld).invert(),p.matrixWorld.decompose(K,Z,T);const m=M();for(c=0;c<m.length;c++)r=m[c],r.ref.matrixWorld.decompose(U,W,T),U.add(I.copy(r.position).applyQuaternion(W).multiply(T)),W.copy(Z).multiply(R.setFromAxisAngle(E,r.rotation+=C*r.rotationFactor)),T.multiplyScalar(r.volume+(1+Math.sin(P*r.density*r.speed))/2*r.growth),r.matrix.compose(U,W,T).premultiply(Y),r.dist=U.distanceTo(K);for(m.sort((it,rt)=>rt.dist-it.dist),c=0;c<m.length;c++)r=m[c],L[c]=r.opacity*(r.dist<r.fade-1?r.dist/r.fade:1),d.setMatrixAt(c,r.matrix),d.setColorAt(c,r.color);d.geometry.attributes.cloudOpacity.needsUpdate=!0,d.instanceMatrix.needsUpdate=!0,d.instanceColor&&(d.instanceColor.needsUpdate=!0)}}}let Gt=0;class Ut extends Q{constructor({opacity:t=1,speed:s=0,bounds:i=new A().fromArray([5,1,1]),segments:v=20,color:x=new X("#ffffff"),fade:e=10,volume:a=6,smallestVolume:L=.25,distribute:F=null,growth:S=4,concentrate:D="inside",seed:h=Math.random()}={}){super(),this.name="cloud_"+Gt++,this.seed=h,this.segments=v,this.bounds=i,this.concentrate=D,this.volume=a,this.smallestVolume=L,this.distribute=F,this.growth=S,this.speed=s,this.fade=e,this.opacity=t,this.color=x,this.ref=this,this.cloudStateArray=[],this.updateCloud()}updateCloudStateArray(){if(this.cloudStateArray.length===this.segments)return;const{segments:t,uuid:s}=this;if(this.cloudStateArray.length>this.segments)this.cloudStateArray.splice(0,this.cloudStateArray.length-this.segments);else for(let i=this.cloudStateArray.length;i<t;i++)this.cloudStateArray.push({segments:t,bounds:new A(1,1,1),position:new A,uuid:s,index:i,ref:this,dist:0,matrix:new et,volume:0,length:0,speed:0,growth:0,opacity:1,fade:0,density:0,rotation:i*(Math.PI/t),rotationFactor:0,color:new X})}updateCloud(){const{volume:t,color:s,speed:i,growth:v,opacity:x,fade:e,bounds:a,seed:L,cloudStateArray:F,distribute:S,segments:D,concentrate:h,smallestVolume:d}=this;this.updateCloudStateArray();let y=0;function M(){const o=Math.sin(L+y)*1e4;return y++,o-Math.floor(o)}F.forEach((o,P)=>{o.segments=D,o.volume=t,o.color=s,o.speed=i,o.growth=v,o.opacity=x,o.fade=e,o.bounds.copy(a),o.density=Math.max(.5,M()),o.rotationFactor=Math.max(.2,.5*M())*i;const c=S?.(o,P);if(c||D>1){var r;o.position.copy(o.bounds).multiply((r=c?.point)!==null&&r!==void 0?r:{x:M()*2-1,y:M()*2-1,z:M()*2-1})}const R=Math.abs(o.position.x),E=Math.abs(o.position.y),I=Math.abs(o.position.z),p=Math.max(R,E,I);o.length=1,R===p&&(o.length-=R/o.bounds.x),E===p&&(o.length-=E/o.bounds.y),I===p&&(o.length-=I/o.bounds.z),o.volume=(c?.volume!==void 0?c.volume:Math.max(Math.max(0,d),h==="random"?M():h==="inside"?o.length:1-o.length))*t})}}let B,u,w,l,g,b,q=new bt;const nt=new Q,Wt=new At,at=new St,zt=new Mt;let f;at.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.5/");Wt.setDRACOLoader(at);const $=new vt,O=[];let ot=()=>{},_;async function Zt(n){b=n,_=b.addFolder("Scene"),B=new ut,app.appendChild(B.dom),u=new ht({antialias:!0}),u.setPixelRatio(Math.min(1.5,window.devicePixelRatio)),u.setSize(window.innerWidth,window.innerHeight),u.shadowMap.enabled=!0,u.shadowMap.type=mt,u.outputColorSpace=ft,u.toneMapping=gt,app.appendChild(u.domElement),w=new wt(50,window.innerWidth/window.innerHeight,.1,200),w.position.set(5,5,5),w.name="Camera",l=new yt,l.add(nt),g=new Ct(w,u.domElement),g.enableDamping=!0,g.dampingFactor=.05,g.minDistance=.1,g.maxDistance=100,g.maxPolarAngle=Math.PI/1.5,g.target.set(0,.5,0),f=new Dt(w,u.domElement),f.addEventListener("dragging-changed",i=>{g.enabled=!i.value,i.value}),f.addEventListener("change",()=>{f.object&&f.object.position.y<0&&(f.object.position.y=0)}),l.add(f.getHelper()),window.addEventListener("resize",Ht),document.addEventListener("pointermove",tt);let t=Date.now();app.addEventListener("pointerdown",()=>{t=Date.now()}),app.addEventListener("pointerup",i=>{Date.now()-t<200&&(tt(i),Vt())}),_.add(f,"mode",["translate","rotate","scale"]);const s=new Et(l);s.setBGType("Default"),s.setEnvType("HDRI"),s.updateAll(),s.addGui(_),await _t(),st()}function Ht(){w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),u.setSize(window.innerWidth,window.innerHeight)}function jt(){B.update(),Rt(),g.update(),ot(),u.render(l,w)}function st(){requestAnimationFrame(st),jt()}function Vt(){if($.setFromCamera(q,w),$.intersectObject(nt,!0,O),!O.length){f.detach();return}O[0].object.selectOnRaycast?f.attach(O[0].object.selectOnRaycast):f.attach(O[0].object),O.length=0}function tt(n){q.x=n.clientX/window.innerWidth*2-1,q.y=-(n.clientY/window.innerHeight)*2+1}async function _t(){const n=new xt;n.intensity=Math.PI/1.5,l.add(n),b.add(n,"intensity",0,100).name("AmbientLight int");const t=[];{const e=new z;e.intensity=30,e.position.fromArray([0,40,0]),e.distance=45,e.decay=0,e.penumbra=1,e.intensity=100,l.add(e);const a=new H(e);b.add(e,"intensity",0,100).name("SpotLight 1 int"),a.visible=!1,t.push(a),l.add(a)}{const e=new z("red");e.intensity=30,e.position.fromArray([-20,0,10]),e.angle=.15,e.decay=0,e.penumbra=-1,e.intensity=30,b.add(e,"intensity",0,100).name("SpotLight 2 int"),l.add(e);const a=new H(e);a.visible=!1,t.push(a),l.add(a)}{const e=new z("green");e.intensity=30,e.position.fromArray([20,-10,10]),e.angle=.2,e.decay=0,e.penumbra=-1,e.intensity=20,b.add(e,"intensity",0,100).name("SpotLight 3 int"),l.add(e);const a=new H(e);a.visible=!1,t.push(a),l.add(a)}const s=await zt.loadAsync(It),i=new Pt({texture:s,limit:1e3,frustumCulled:!1});l.add(i);function v(e){const a=new Ut;e?a.position.fromArray(e):(a.position.random().multiplyScalar(20),a.bounds.set(j.randInt(1,8),j.randInt(1,4),j.randInt(1,4)),a.color.setHSL(Math.random(),Math.random(),Math.random()),a.updateCloud()),i.ref.add(a.ref),Bt(a),console.warn({[a.name]:a}),new Ot(g.target).to(a.position,500).easing(Ft.Quadratic.InOut).start()}b.add({visible:!1},"visible").name("Helper visible").onChange(e=>t.forEach(a=>a.visible=e)),b.add({addCloud:v},"addCloud").name("Add new Cloud"),v([0,0,0]);const x=new Lt;ot=()=>{i.update(w,x.getElapsedTime(),x.getDelta())}}function Bt(n){const t=b.addFolder("Edit: "+n.name);t.onChange(()=>n.updateCloud()),t.addColor(n,"color"),t.add(n,"seed",0,100,1),t.add(n,"segments",1,80,1),t.add(n,"volume",0,100,.1),t.add(n,"opacity",0,1,.01),t.add(n,"fade",0,400,1),t.add(n,"growth",0,20,1),t.add(n,"speed",0,1,.01),t.add(n,"removeFromParent").onChange(()=>{t.destroy()});const s=t.addFolder("bounds").close();s.add(n.bounds,"x",0,25,.5),s.add(n.bounds,"y",0,25,.5),s.add(n.bounds,"z",0,25,.5);const i=t.addFolder("position").close();i.add(n.position,"x",-10,10,.1),i.add(n.position,"y",-10,10,.1),i.add(n.position,"z",-10,10,.1)}export{Zt as default};
