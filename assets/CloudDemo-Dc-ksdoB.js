import{S as ct,O as lt,G as pt,D as ut}from"./OrbitControls-BThPDOU9.js";import{T as ht}from"./TransformControls-i8oTrZWj.js";import{G as Q,d as mt,aL as N,aM as X,aF as ft,s as A,_ as et,aO as k,ax as gt,C as Y,z as wt,W as yt,V as Ct,S as bt,aQ as xt,a as vt,b as Mt,c as At,R as St,n as Lt,p as z,q as H,T as Dt,o as _,l as Ot}from"./three.module-mb-WANHP.js";import{T as Et,G as Ft,E as Rt}from"./tween.esm-DFB-vPb4.js";import{B as Gt}from"./BG_ENV-Dmm91why.js";import"./EXRLoader-CrxFBtHm.js";import"./RGBELoader-DeKSjiHf.js";import"./GroundProjectedSkybox-ZeOOmZad.js";import"./HDRI_LIST-DJCqOZOR.js";const j=(n,t)=>{"updateRanges"in n?n.updateRanges[0]=t:n.updateRange=t},It="https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png",$=new et,U=new A,W=new k,J=new A,K=new k,I=new A,Pt=n=>class extends n{constructor(){super();const t=parseInt(wt.replace(/\D+/g,""))>=154?"opaque_fragment":"output_fragment";this.onBeforeCompile=s=>{s.vertexShader=`attribute float cloudOpacity;
               varying float vOpacity;
              `+s.vertexShader.replace("#include <fog_vertex>",`#include <fog_vertex>
                 vOpacity = cloudOpacity;
                `),s.fragmentShader=`varying float vOpacity;
              `+s.fragmentShader.replace(`#include <${t}>`,`#include <${t}>
                 gl_FragColor = vec4(outgoingLight, diffuseColor.a * vOpacity);
                `)}}};class Tt extends Q{constructor({limit:t=200,range:s,material:i=gt,texture:x,frustumCulled:v=!0}={}){super(),this.name="Clouds",this.ref=this;const e=this,a=new mt(1,1),L=new Float32Array(Array.from({length:t},()=>1)),E=new Float32Array(Array.from({length:t},()=>[1,1,1]).flat()),S=new N(L,1);S.setUsage(X),a.setAttribute("cloudOpacity",S);const D=Pt(i),h=new D;h.map=x,h.transparent=!0,h.depthWrite=!1,h.needsUpdate=!0,this.cloudMaterial=h,this.instance=new ft(a,h,t);const d=this.instance;d.matrixAutoUpdate=!1,d.frustumCulled=v,d.instanceColor=new N(E,3),d.instanceColor.setUsage(X),e.add(d);const y=[],M=()=>{const p=y.length;let T=0;for(let C=0;C<this.ref.children.length;C++){const m=this.ref.children[C];m.cloudStateArray&&(T+=m.cloudStateArray.length)}if(p===T)return y;y.length=0;for(let C=0;C<this.ref.children.length;C++){const m=this.ref.children[C];m.cloudStateArray&&y.push(...m.cloudStateArray)}return o(),y},o=()=>{const p=Math.min(t,s!==void 0?s:t,y.length);d.count=p,j(d.instanceMatrix,{offset:0,count:p*16}),d.instanceColor&&j(d.instanceColor,{offset:0,count:p*3}),j(d.geometry.attributes.cloudOpacity,{offset:0,count:p})};let P=0,c=0,r;const F=new k,R=new A(0,0,1),G=new A;this.update=(p,T,C)=>{P=T,$.copy(d.matrixWorld).invert(),p.matrixWorld.decompose(J,K,I);const m=M();for(c=0;c<m.length;c++)r=m[c],r.ref.matrixWorld.decompose(U,W,I),U.add(G.copy(r.position).applyQuaternion(W).multiply(I)),W.copy(K).multiply(F.setFromAxisAngle(R,r.rotation+=C*r.rotationFactor)),I.multiplyScalar(r.volume+(1+Math.sin(P*r.density*r.speed))/2*r.growth),r.matrix.compose(U,W,I).premultiply($),r.dist=U.distanceTo(J);for(m.sort((rt,dt)=>dt.dist-rt.dist),c=0;c<m.length;c++)r=m[c],L[c]=r.opacity*(r.dist<r.fade-1?r.dist/r.fade:1),d.setMatrixAt(c,r.matrix),d.setColorAt(c,r.color);d.geometry.attributes.cloudOpacity.needsUpdate=!0,d.instanceMatrix.needsUpdate=!0,d.instanceColor&&(d.instanceColor.needsUpdate=!0)}}}let Ut=0;class Wt extends Q{constructor({opacity:t=1,speed:s=0,bounds:i=new A().fromArray([5,1,1]),segments:x=20,color:v=new Y("#ffffff"),fade:e=10,volume:a=6,smallestVolume:L=.25,distribute:E=null,growth:S=4,concentrate:D="inside",seed:h=Math.random()}={}){super(),this.name="cloud_"+Ut++,this.seed=h,this.segments=x,this.bounds=i,this.concentrate=D,this.volume=a,this.smallestVolume=L,this.distribute=E,this.growth=S,this.speed=s,this.fade=e,this.opacity=t,this.color=v,this.ref=this,this.cloudStateArray=[],this.updateCloud()}updateCloudStateArray(){if(this.cloudStateArray.length===this.segments)return;const{segments:t,uuid:s}=this;if(this.cloudStateArray.length>this.segments)this.cloudStateArray.splice(0,this.cloudStateArray.length-this.segments);else for(let i=this.cloudStateArray.length;i<t;i++)this.cloudStateArray.push({segments:t,bounds:new A(1,1,1),position:new A,uuid:s,index:i,ref:this,dist:0,matrix:new et,volume:0,length:0,speed:0,growth:0,opacity:1,fade:0,density:0,rotation:i*(Math.PI/t),rotationFactor:0,color:new Y})}updateCloud(){const{volume:t,color:s,speed:i,growth:x,opacity:v,fade:e,bounds:a,seed:L,cloudStateArray:E,distribute:S,segments:D,concentrate:h,smallestVolume:d}=this;this.updateCloudStateArray();let y=0;function M(){const o=Math.sin(L+y)*1e4;return y++,o-Math.floor(o)}E.forEach((o,P)=>{o.segments=D,o.volume=t,o.color=s,o.speed=i,o.growth=x,o.opacity=v,o.fade=e,o.bounds.copy(a),o.density=Math.max(.5,M()),o.rotationFactor=Math.max(.2,.5*M())*i;const c=S?.(o,P);if(c||D>1){var r;o.position.copy(o.bounds).multiply((r=c?.point)!==null&&r!==void 0?r:{x:M()*2-1,y:M()*2-1,z:M()*2-1})}const F=Math.abs(o.position.x),R=Math.abs(o.position.y),G=Math.abs(o.position.z),p=Math.max(F,R,G);o.length=1,F===p&&(o.length-=F/o.bounds.x),R===p&&(o.length-=R/o.bounds.y),G===p&&(o.length-=G/o.bounds.z),o.volume=(c?.volume!==void 0?c.volume:Math.max(Math.max(0,d),h==="random"?M():h==="inside"?o.length:1-o.length))*t})}}const nt=new Ft;let B,u,w,l,g,b,q=new At;const at=new Q,zt=new pt,ot=new ut,Ht=new Dt;let f;ot.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.5/");zt.setDRACOLoader(ot);const Z=new St,O=[];let st=()=>{},V;async function te(n){b=n,V=b.addFolder("Scene"),B=new ct,app.appendChild(B.dom),u=new yt({antialias:!0}),u.setPixelRatio(Math.min(1.5,window.devicePixelRatio)),u.setSize(window.innerWidth,window.innerHeight),u.shadowMap.enabled=!0,u.shadowMap.type=Ct,u.outputColorSpace=bt,u.toneMapping=xt,app.appendChild(u.domElement),w=new vt(50,window.innerWidth/window.innerHeight,.1,200),w.position.set(5,5,5),w.name="Camera",l=new Mt,l.add(at),g=new lt(w,u.domElement),g.enableDamping=!0,g.dampingFactor=.05,g.minDistance=.1,g.maxDistance=100,g.maxPolarAngle=Math.PI/1.5,g.target.set(0,.5,0),f=new ht(w,u.domElement),f.addEventListener("dragging-changed",i=>{g.enabled=!i.value,i.value}),f.addEventListener("change",()=>{f.object&&f.object.position.y<0&&(f.object.position.y=0)}),l.add(f.getHelper()),window.addEventListener("resize",_t),document.addEventListener("pointermove",tt);let t=Date.now();app.addEventListener("pointerdown",()=>{t=Date.now()}),app.addEventListener("pointerup",i=>{Date.now()-t<200&&(tt(i),Vt())}),V.add(f,"mode",["translate","rotate","scale"]);const s=new Gt(l);s.setBGType("Default"),s.setEnvType("HDRI"),s.updateAll(),s.addGui(V),await Bt(),it()}function _t(){w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),u.setSize(window.innerWidth,window.innerHeight)}function jt(){B.update(),nt.update(),g.update(),st(),u.render(l,w)}function it(){requestAnimationFrame(it),jt()}function Vt(){if(Z.setFromCamera(q,w),Z.intersectObject(at,!0,O),!O.length){f.detach();return}O[0].object.selectOnRaycast?f.attach(O[0].object.selectOnRaycast):f.attach(O[0].object),O.length=0}function tt(n){q.x=n.clientX/window.innerWidth*2-1,q.y=-(n.clientY/window.innerHeight)*2+1}async function Bt(){const n=new Lt;n.intensity=Math.PI/1.5,l.add(n),b.add(n,"intensity",0,100).name("AmbientLight int");const t=[];{const e=new z;e.intensity=30,e.position.fromArray([0,40,0]),e.distance=45,e.decay=0,e.penumbra=1,e.intensity=100,l.add(e);const a=new H(e);b.add(e,"intensity",0,100).name("SpotLight 1 int"),a.visible=!1,t.push(a),l.add(a)}{const e=new z("red");e.intensity=30,e.position.fromArray([-20,0,10]),e.angle=.15,e.decay=0,e.penumbra=-1,e.intensity=30,b.add(e,"intensity",0,100).name("SpotLight 2 int"),l.add(e);const a=new H(e);a.visible=!1,t.push(a),l.add(a)}{const e=new z("green");e.intensity=30,e.position.fromArray([20,-10,10]),e.angle=.2,e.decay=0,e.penumbra=-1,e.intensity=20,b.add(e,"intensity",0,100).name("SpotLight 3 int"),l.add(e);const a=new H(e);a.visible=!1,t.push(a),l.add(a)}const s=await Ht.loadAsync(It),i=new Tt({texture:s,limit:1e3,frustumCulled:!1});l.add(i);function x(e){const a=new Wt;e?a.position.fromArray(e):(a.position.random().multiplyScalar(20),a.bounds.set(_.randInt(1,8),_.randInt(1,4),_.randInt(1,4)),a.color.setHSL(Math.random(),Math.random(),Math.random()),a.updateCloud()),i.ref.add(a.ref),qt(a),console.warn({[a.name]:a}),new Et(g.target,nt).to(a.position,500).easing(Rt.Quadratic.InOut).start()}b.add({visible:!1},"visible").name("Helper visible").onChange(e=>t.forEach(a=>a.visible=e)),b.add({addCloud:x},"addCloud").name("Add new Cloud"),x([0,0,0]);const v=new Ot;st=()=>{i.update(w,v.getElapsedTime(),v.getDelta())}}function qt(n){const t=b.addFolder("Edit: "+n.name);t.onChange(()=>n.updateCloud()),t.addColor(n,"color"),t.add(n,"seed",0,100,1),t.add(n,"segments",1,80,1),t.add(n,"volume",0,100,.1),t.add(n,"opacity",0,1,.01),t.add(n,"fade",0,400,1),t.add(n,"growth",0,20,1),t.add(n,"speed",0,1,.01),t.add(n,"removeFromParent").onChange(()=>{t.destroy()});const s=t.addFolder("bounds").close();s.add(n.bounds,"x",0,25,.5),s.add(n.bounds,"y",0,25,.5),s.add(n.bounds,"z",0,25,.5);const i=t.addFolder("position").close();i.add(n.position,"x",-10,10,.1),i.add(n.position,"y",-10,10,.1),i.add(n.position,"z",-10,10,.1)}export{te as default};
