import{W as se,V as ie,S as de,A as le,a as pe,b as ce,G as ue,c as $,R as me,C as J,M as T,f as V,g as b,B as he,d as ge,o as x,i as we,H as fe,L as U,E as X,n as Se,p as ye,q as Le,r as Me,s as K,t as Pe,u as xe,v as ve,U as Ce}from"./three.module-mb-WANHP.js";import{S as Te,O as Fe,G as Re,D as be}from"./OrbitControls-BThPDOU9.js";import{E as Ee}from"./EXRLoader-CrxFBtHm.js";import{G as Ge}from"./GroundProjectedSkybox-ZeOOmZad.js";import{T as De}from"./TransformControls-i8oTrZWj.js";import{H as Q}from"./HDRI_LIST-DJCqOZOR.js";import{G as He,T as je,E as ze}from"./tween.esm-DFB-vPb4.js";import{R as Oe}from"./RGBELoader-DeKSjiHf.js";import{a as _e,M as Ae}from"./MODEL_LIST-CtQt_fBO.js";import{L as Be}from"./LoadingHelper-Bpwvv_dV.js";import{S as We}from"./SpotLightMaterial-CRQYSWHJ.js";import"./shaderMaterial-BmLXph0Z.js";import"./constants-9lyQ_GmL.js";const Z=new He;let j,i,h,p,S,z,w,O=new $;const C={environment:Q.kloppenheim,groundProjection:!1,bgColor:new J,printCam:()=>{}},P=new ue,Ie=new Ee,ke=new Oe,Ve=new Re,ee=new be;let L;ee.setDecoderPath("https://www.gstatic.com/draco/v1/decoders/");Ve.setDRACOLoader(ee);const q=new me,H=[];let te=()=>{},G;async function ut(a){z=a,G=z.addFolder("Scene"),j=new Te,app.appendChild(j.dom),i=new se({antialias:!0}),i.setPixelRatio(Math.min(1.5,window.devicePixelRatio)),i.setSize(window.innerWidth,window.innerHeight),i.shadowMap.enabled=!0,i.shadowMap.type=ie,i.outputColorSpace=de,i.toneMapping=le,app.appendChild(i.domElement),h=new pe(50,window.innerWidth/window.innerHeight,.1,200),h.position.set(-16,16,16),h.name="Camera",p=new ce,p.add(P),S=new Fe(h,i.domElement),S.enableDamping=!0,S.dampingFactor=.05,S.minDistance=.1,S.maxDistance=100,S.maxPolarAngle=Math.PI/1.5,S.target.set(0,0,0),S.target.set(0,0,0),L=new De(h,i.domElement),L.addEventListener("dragging-changed",e=>{S.enabled=!e.value,e.value}),L.addEventListener("change",()=>{L.object&&L.object.position.y<0&&(L.object.position.y=0)}),p.add(L.getHelper()),window.addEventListener("resize",Xe),document.addEventListener("pointermove",N);let r=Date.now();app.addEventListener("pointerdown",()=>{r=Date.now()}),app.addEventListener("pointerup",e=>{Date.now()-r<200&&(N(e),Ne())}),G.add(L,"mode",["translate","rotate","scale"]),Ue(),await Ye(),ne()}async function Ue(){function a(e){if(!e){p.background=null,p.environment=null;return}e.exr&&Ie.load(e.exr,o=>{o.mapping=X,p.environment=o}),e.hdr&&ke.load(e.hdr,o=>{o.mapping=X,p.environment=o})}function r(e){C.groundProjection&&p.background&&e.groundProj?(w||(w=new Ge(p.background),w.scale.setScalar(100)),w.material.uniforms.map.value=p.background,w.radius=e.groundProj.radius,w.height=e.groundProj.height,w.parent||p.add(w)):w&&w.parent&&w.removeFromParent()}a(C.environment),G.add(C,"environment",Q).onChange(e=>{a(e)}),G.add(C,"groundProjection").onChange(e=>{r(C.environment)})}function Xe(){h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),i.setSize(window.innerWidth,window.innerHeight)}function qe(){j.update(),Z.update(),te(),S.update(),i.render(p,h)}function ne(){requestAnimationFrame(ne),qe()}function Ne(){q.setFromCamera(O,h),q.intersectObject(P,!0,H),H.length&&(H.length=0)}function N(a){O.x=a.clientX/window.innerWidth*2-1,O.y=-(a.clientY/window.innerHeight)*2+1}async function Ye(){const a=new T(new V(.5).translate(0,.5,0),new b({color:E(),roughness:0,metalness:1}));a.name="sphere",a.castShadow=!0,a.receiveShadow=!0,a.position.set(2,0,-1.5),P.add(a);const r=new T(new he(1,1,1).translate(0,.5,0),new b({color:E(),roughness:0,metalness:1}));r.name="cube",r.castShadow=!0,r.receiveShadow=!0,r.position.set(-2,0,-1.5),P.add(r);const e=new T(new ge(10,10).rotateX(-Math.PI/2),new b({color:E(),roughness:.5,metalness:0}));e.name="floor",e.receiveShadow=!0,P.add(e);const o=new Be,s=(await _e(Ae.porsche_1975.url,{loadingHelper:o})).scene;s.name="car",s.traverse(d=>{d.isMesh&&(d.castShadow=!0,d.receiveShadow=!0,d.selectOnRaycast=s)}),P.add(s);for(let d=0;d<30;d++){const u=new T(new V(.3),new b({color:E(),roughness:0,metalness:0}));u.name="sphere",u.castShadow=!0,u.receiveShadow=!0,u.position.set(x.randFloatSpread(10),x.randFloat(0,5),x.randFloatSpread(10)),P.add(u)}$e()}function $e(){p.add(new Se(16777215,.5));const a=new $;let r=1,e,o,c=16777215,s=20,d=.15*4,u=5;const t=new ye;t.intensity=3,t.position.set(5,5,5),t.angle=d,t.color.set(c),t.distance=s,t.castShadow=!0,t.shadow.bias=-1e-4;const v=new Le(t);p.add(t);const n=new We,ae=new Me({transparent:!0,opacity:.25}),_={volumeMaterial:n,basicMaterial:ae};let D,A=()=>{};function B(){if(f.useDepth){const y=Ke({size:f.depthResolution});let l=D;D=y[0],n.depth=y[0],A=y[1],i.getSize(a),a.multiplyScalar(i.getPixelRatio()),n.resolution.copy(a),l&&l.dispose()}else n.depth=null,n.resolution.set(0,0)}n.spotPosition=t.position,n.opacity=r,n.lightColor=t.color,n.attenuation=t.distance,n.anglePower=u,n.cameraNear=h.near,n.cameraFar=h.far,e=e===void 0?.1:e,o=o===void 0?t.angle*7:o,console.log({volumeMaterial:n});const F=()=>{n.attenuation=t.distance,s=t.distance,o=Math.tan(t.angle)*t.distance,R.geometry=W(s,e,o)},f={materialType:_.volumeMaterial,helper:!1,useDepth:!1,depthResolution:1,updateVolumeGeometry:F,animateTarget:!1,animateLight:!1},W=(y,l,m)=>{const g=new Pe(l,m,y,128,64,!0);return g.translate(0,-y/2,0),g.rotateX(-Math.PI/2),g},R=new T(W(s,e,o),n);F(),t.add(R);const oe=new K;te=()=>{R.lookAt(t.target.getWorldPosition(oe)),v.parent&&v.update(),f.useDepth&&(n.depth=null,A(),n.depth=D)},window.onresize=()=>{i.getSize(a),a.multiplyScalar(i.getPixelRatio()),f.useDepth&&n.resolution.copy(a),console.log(n.resolution)};function re(y){const l=y.addFolder("SpotLight Volume");l.open(),l.add(f,"materialType",_).onChange(g=>{R.material=g}),l.add(f,"useDepth").onChange(B),l.add(f,"depthResolution",.1,1,.1).onChange(B),l.add(n,"opacity",0,2),l.add(n,"attenuation",0,s),l.add(n,"anglePower",0,Math.PI),l.add(n,"cameraNear",0,10),l.add(n,"cameraFar",0,10),l.add(n.resolution,"x",0,1e3,1).listen(),l.add(n.resolution,"y",0,1e3,1).listen();const m=y.addFolder("SpotLight");m.open(),m.add(f,"helper").onChange(g=>{g?p.add(v):v.removeFromParent()}),m.addColor(t,"color"),m.add(t,"intensity",0,500),m.add(t,"angle",0,Math.PI/2).onChange(F),m.add(t,"penumbra",0,1),m.add(t,"distance",.1,20).onChange(F),m.add(t.shadow,"bias",-1e-4,1e-4),m.add(f,"animateTarget").name("ðŸš²Animate target").onChange(g=>{g?I.start():I.stop()}),m.add(f,"animateLight").name("ðŸš²Animate light").onChange(g=>{g?k.start():k.stop()})}L.attach(t),re(z);const I=Y(t.target.position,20,2e3,1e3),k=Y(t.position,20,2e3,1e3)}const Je=new J;function E(){return"#"+Je.setHSL(Math.random(),.5,.5).getHexString()}let M;function Ke({size:a,frames:r=1/0}={}){const e=i,o=new K;e.getSize(o),o.multiplyScalar(e.getPixelRatio());const c=a*o.x,s=a*o.y;console.log("depth tex res",c,s);const d=new xe(c,s);d.format=ve,d.type=Ce,d.name="Depth_Buffer";let u=0;M?M.depthTexture.dispose():M=Qe(c,s),M.depthTexture=d,M.setSize(c,s);const t=()=>{(r===1/0||u<r)&&(e.setRenderTarget(M),e.render(p,h),e.setRenderTarget(null),u++)};return[M.depthTexture,t]}function Y(a,r,e,o){const c=new je(a,Z).to({x:x.randFloatSpread(r),z:x.randFloatSpread(r)},e).easing(ze.Bounce.Out).repeat(1e4).repeatDelay(o).onStart(()=>{s()}).onRepeat(()=>{s(),c._valuesEnd.x=x.randFloatSpread(6),c._valuesEnd.z=x.randFloatSpread(6)}),s=()=>{c._valuesStart.x=a.x,c._valuesStart.z=a.z};return c}function Qe(a,r,e={}){const o=i,c=a,s=r,d=e,{samples:u=0,depth:t,...v}=d;let n;return n=new we(c,s,{minFilter:U,magFilter:U,colorSpace:o.outputColorSpace,type:fe,...v}),n.samples=u,n}export{ut as default,Qe as useFBO};
