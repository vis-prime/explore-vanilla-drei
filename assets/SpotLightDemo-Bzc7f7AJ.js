import{S as re,W as se,V as ie,a as de,A as le,b as pe,c as ce,G as ue,O as me,d as J,R as he,C as K,M as T,g as V,h as b,B as ge,e as we,r as P,k as fe,H as Se,L as U,E as X,q as ye,s as Le,t as Me,u as xe,v as Q,w as Pe,x as ve,y as Ce,U as Te,i as Fe,n as Re}from"./OrbitControls-R0lqBEeo.js";import{E as be}from"./EXRLoader-CueWY_mu.js";import{G as Ee}from"./GroundProjectedSkybox-C8DAfX2s.js";import{T as De}from"./TransformControls-C9PpcTYI.js";import{H as Z}from"./HDRI_LIST-DJCqOZOR.js";import{u as Ge,T as He,E as je}from"./tween.esm-DFB-vPb4.js";import{R as ze}from"./RGBELoader-C-6F00h6.js";import{a as Oe,M as _e}from"./MODEL_LIST-CX7Ggjim.js";import{L as Ae}from"./LoadingHelper-Bpwvv_dV.js";import{S as Be}from"./SpotLightMaterial-CnHQ0_Q-.js";import"./shaderMaterial-CnuFB52m.js";import"./constants-CqDbEtfV.js";let j,i,h,p,S,z,w,O=new J;const C={environment:Z.kloppenheim,groundProjection:!1,bgColor:new K,printCam:()=>{}},x=new ue,Ie=new be,We=new ze,ke=new Fe,$=new Re;let L;$.setDecoderPath("https://www.gstatic.com/draco/v1/decoders/");ke.setDRACOLoader($);const q=new he,H=[];let ee=()=>{},D;async function pt(a){z=a,D=z.addFolder("Scene"),j=new re,app.appendChild(j.dom),i=new se({antialias:!0}),i.setPixelRatio(Math.min(1.5,window.devicePixelRatio)),i.setSize(window.innerWidth,window.innerHeight),i.shadowMap.enabled=!0,i.shadowMap.type=ie,i.outputColorSpace=de,i.toneMapping=le,app.appendChild(i.domElement),h=new pe(50,window.innerWidth/window.innerHeight,.1,200),h.position.set(-16,16,16),h.name="Camera",p=new ce,p.add(x),S=new me(h,i.domElement),S.enableDamping=!0,S.dampingFactor=.05,S.minDistance=.1,S.maxDistance=100,S.maxPolarAngle=Math.PI/1.5,S.target.set(0,0,0),S.target.set(0,0,0),L=new De(h,i.domElement),L.addEventListener("dragging-changed",e=>{S.enabled=!e.value,e.value}),L.addEventListener("change",()=>{L.object&&L.object.position.y<0&&(L.object.position.y=0)}),p.add(L.getHelper()),window.addEventListener("resize",Ue),document.addEventListener("pointermove",N);let r=Date.now();app.addEventListener("pointerdown",()=>{r=Date.now()}),app.addEventListener("pointerup",e=>{Date.now()-r<200&&(N(e),qe())}),D.add(L,"mode",["translate","rotate","scale"]),Ve(),await Ne(),te()}async function Ve(){function a(e){if(!e){p.background=null,p.environment=null;return}e.exr&&Ie.load(e.exr,o=>{o.mapping=X,p.environment=o}),e.hdr&&We.load(e.hdr,o=>{o.mapping=X,p.environment=o})}function r(e){C.groundProjection&&p.background&&e.groundProj?(w||(w=new Ee(p.background),w.scale.setScalar(100)),w.material.uniforms.map.value=p.background,w.radius=e.groundProj.radius,w.height=e.groundProj.height,w.parent||p.add(w)):w&&w.parent&&w.removeFromParent()}a(C.environment),D.add(C,"environment",Z).onChange(e=>{a(e)}),D.add(C,"groundProjection").onChange(e=>{r(C.environment)})}function Ue(){h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),i.setSize(window.innerWidth,window.innerHeight)}function Xe(){j.update(),Ge(),ee(),S.update(),i.render(p,h)}function te(){requestAnimationFrame(te),Xe()}function qe(){q.setFromCamera(O,h),q.intersectObject(x,!0,H),H.length&&(H.length=0)}function N(a){O.x=a.clientX/window.innerWidth*2-1,O.y=-(a.clientY/window.innerHeight)*2+1}async function Ne(){const a=new T(new V(.5).translate(0,.5,0),new b({color:E(),roughness:0,metalness:1}));a.name="sphere",a.castShadow=!0,a.receiveShadow=!0,a.position.set(2,0,-1.5),x.add(a);const r=new T(new ge(1,1,1).translate(0,.5,0),new b({color:E(),roughness:0,metalness:1}));r.name="cube",r.castShadow=!0,r.receiveShadow=!0,r.position.set(-2,0,-1.5),x.add(r);const e=new T(new we(10,10).rotateX(-Math.PI/2),new b({color:E(),roughness:.5,metalness:0}));e.name="floor",e.receiveShadow=!0,x.add(e);const o=new Ae,s=(await Oe(_e.porsche_1975.url,{loadingHelper:o})).scene;s.name="car",s.traverse(d=>{d.isMesh&&(d.castShadow=!0,d.receiveShadow=!0,d.selectOnRaycast=s)}),x.add(s);for(let d=0;d<30;d++){const u=new T(new V(.3),new b({color:E(),roughness:0,metalness:0}));u.name="sphere",u.castShadow=!0,u.receiveShadow=!0,u.position.set(P.randFloatSpread(10),P.randFloat(0,5),P.randFloatSpread(10)),x.add(u)}Ye()}function Ye(){p.add(new ye(16777215,.5));const a=new J;let r=1,e,o,c=16777215,s=20,d=.15*4,u=5;const t=new Le;t.intensity=3,t.position.set(5,5,5),t.angle=d,t.color.set(c),t.distance=s,t.castShadow=!0,t.shadow.bias=-1e-4;const v=new Me(t);p.add(t);const n=new Be,ne=new xe({transparent:!0,opacity:.25}),_={volumeMaterial:n,basicMaterial:ne};let G,A=()=>{};function B(){if(f.useDepth){const y=Ke({size:f.depthResolution});let l=G;G=y[0],n.depth=y[0],A=y[1],i.getSize(a),a.multiplyScalar(i.getPixelRatio()),n.resolution.copy(a),l&&l.dispose()}else n.depth=null,n.resolution.set(0,0)}n.spotPosition=t.position,n.opacity=r,n.lightColor=t.color,n.attenuation=t.distance,n.anglePower=u,n.cameraNear=h.near,n.cameraFar=h.far,e=e===void 0?.1:e,o=o===void 0?t.angle*7:o,console.log({volumeMaterial:n});const F=()=>{n.attenuation=t.distance,s=t.distance,o=Math.tan(t.angle)*t.distance,R.geometry=I(s,e,o)},f={materialType:_.volumeMaterial,helper:!1,useDepth:!1,depthResolution:1,updateVolumeGeometry:F,animateTarget:!1,animateLight:!1},I=(y,l,m)=>{const g=new Pe(l,m,y,128,64,!0);return g.translate(0,-y/2,0),g.rotateX(-Math.PI/2),g},R=new T(I(s,e,o),n);F(),t.add(R);const ae=new Q;ee=()=>{R.lookAt(t.target.getWorldPosition(ae)),v.parent&&v.update(),f.useDepth&&(n.depth=null,A(),n.depth=G)},window.onresize=()=>{i.getSize(a),a.multiplyScalar(i.getPixelRatio()),f.useDepth&&n.resolution.copy(a),console.log(n.resolution)};function oe(y){const l=y.addFolder("SpotLight Volume");l.open(),l.add(f,"materialType",_).onChange(g=>{R.material=g}),l.add(f,"useDepth").onChange(B),l.add(f,"depthResolution",.1,1,.1).onChange(B),l.add(n,"opacity",0,2),l.add(n,"attenuation",0,s),l.add(n,"anglePower",0,Math.PI),l.add(n,"cameraNear",0,10),l.add(n,"cameraFar",0,10),l.add(n.resolution,"x",0,1e3,1).listen(),l.add(n.resolution,"y",0,1e3,1).listen();const m=y.addFolder("SpotLight");m.open(),m.add(f,"helper").onChange(g=>{g?p.add(v):v.removeFromParent()}),m.addColor(t,"color"),m.add(t,"intensity",0,500),m.add(t,"angle",0,Math.PI/2).onChange(F),m.add(t,"penumbra",0,1),m.add(t,"distance",.1,20).onChange(F),m.add(t.shadow,"bias",-1e-4,1e-4),m.add(f,"animateTarget").name("ðŸš²Animate target").onChange(g=>{g?W.start():W.stop()}),m.add(f,"animateLight").name("ðŸš²Animate light").onChange(g=>{g?k.start():k.stop()})}L.attach(t),oe(z);const W=Y(t.target.position,20,2e3,1e3),k=Y(t.position,20,2e3,1e3)}const Je=new K;function E(){return"#"+Je.setHSL(Math.random(),.5,.5).getHexString()}let M;function Ke({size:a,frames:r=1/0}={}){const e=i,o=new Q;e.getSize(o),o.multiplyScalar(e.getPixelRatio());const c=a*o.x,s=a*o.y;console.log("depth tex res",c,s);const d=new ve(c,s);d.format=Ce,d.type=Te,d.name="Depth_Buffer";let u=0;M?M.depthTexture.dispose():M=Qe(c,s),M.depthTexture=d,M.setSize(c,s);const t=()=>{(r===1/0||u<r)&&(e.setRenderTarget(M),e.render(p,h),e.setRenderTarget(null),u++)};return[M.depthTexture,t]}function Y(a,r,e,o){const c=new He(a).to({x:P.randFloatSpread(r),z:P.randFloatSpread(r)},e).easing(je.Bounce.Out).repeat(1e4).repeatDelay(o).onStart(()=>{s()}).onRepeat(()=>{s(),c._valuesEnd.x=P.randFloatSpread(6),c._valuesEnd.z=P.randFloatSpread(6)}),s=()=>{c._valuesStart.x=a.x,c._valuesStart.z=a.z};return c}function Qe(a,r,e={}){const o=i,c=a,s=r,d=e,{samples:u=0,depth:t,...v}=d;let n;return n=new fe(c,s,{minFilter:U,magFilter:U,colorSpace:o.outputColorSpace,type:Se,...v}),n.samples=u,n}export{pt as default,Qe as useFBO};
