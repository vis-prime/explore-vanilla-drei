import{S as ee,W as ae,V as ne,a as D,A as oe,P as te,b as re,c as se,G as V,O as ie,d as de,R as le,D as ce,M as T,e as me,f as ue,C as X,g as he,h as H,B as pe,E as L,T as fe,i as we,j as ge,k as O,H as B,L as k,l as be,m as q,F as Me,n as ye,o as Se,N as ke}from"./OrbitControls-R0lqBEeo.js";import{E as Ce}from"./EXRLoader-CueWY_mu.js";import{G as xe}from"./GroundProjectedSkybox-C8DAfX2s.js";import{T as Pe}from"./TransformControls-C9PpcTYI.js";import{H as N}from"./HDRI_LIST-DJCqOZOR.js";import{R as Le}from"./RGBELoader-C-6F00h6.js";import{M as Te}from"./MODEL_LIST-CX7Ggjim.js";import{M as Ee}from"./MeshDiscardMaterial-UfTKQmYb.js";import{M as Re}from"./MeshTransmissionMaterial-PT71Sorh.js";import"./shaderMaterial-CnuFB52m.js";let E,d,h,s,p,b,m,R=new de;const f={environment:N.ulmer_muenster,groundProjection:!0,bgColor:new X,printCam:()=>{}},M=new V,je=new fe,Fe=new Ce,Ge=new Le,Y=new we,J=new ye;let u;J.setDecoderPath("https://www.gstatic.com/draco/v1/decoders/");Y.setDRACOLoader(J);const W=new le,w=[];let K=()=>{},C,z;async function Ze(o){b=o,C=b.addFolder("Scene"),E=new ee,app.appendChild(E.dom),d=new ae({antialias:!0}),d.setPixelRatio(Math.min(1.5,window.devicePixelRatio)),d.setSize(window.innerWidth,window.innerHeight),d.shadowMap.enabled=!0,d.shadowMap.type=ne,d.outputColorSpace=D,d.toneMapping=oe,z=new te(d),z.compileCubemapShader(),app.appendChild(d.domElement),h=new re(50,window.innerWidth/window.innerHeight,.1,200),h.position.set(6,3,6),h.name="Camera",h.position.set(2.0404140991899564,2.644387886134694,3.8683136783076355),s=new se,s.add(M),p=new ie(h,d.domElement),p.enableDamping=!0,p.dampingFactor=.05,p.minDistance=.1,p.maxDistance=100,p.maxPolarAngle=Math.PI/1.5,p.target.set(0,0,0),p.target.set(0,0,0),u=new Pe(h,d.domElement),u.addEventListener("dragging-changed",a=>{p.enabled=!a.value,a.value}),u.addEventListener("change",()=>{u.object&&u.object.position.y<0&&(u.object.position.y=0)}),s.add(u.getHelper()),window.addEventListener("resize",Ae),document.addEventListener("pointermove",I);let e=Date.now();app.addEventListener("pointerdown",()=>{e=Date.now()}),app.addEventListener("pointerup",a=>{Date.now()-e<200&&(I(a),Oe())}),C.add(u,"mode",["translate","rotate","scale"]),ve(),await Be(),Q()}async function ve(){let o=new V,e=new ce(16777195,1);e.name="Dir. Light",e.castShadow=!0,e.shadow.camera.near=.1,e.shadow.camera.far=50,e.shadow.camera.right=15,e.shadow.camera.left=-15,e.shadow.camera.top=15,e.shadow.camera.bottom=-15,e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,e.shadow.radius=1.95,e.shadow.blurSamples=6,e.shadow.bias=-5e-4,o.add(e),s.add(o);const a=new T(new me(10,10).rotateX(-Math.PI/2),new ue({}));a.name="shadowFloor",a.receiveShadow=!0,a.position.set(0,0,0),s.add(a);async function t(n){if(!n){s.background=null,s.environment=null;return}if(n.exr){const c=await Fe.loadAsync(n.exr);c.mapping=L,s.environment=c,console.log("exr loaded")}if(n.hdr){const c=await Ge.loadAsync(n.hdr);c.mapping=L,s.environment=c,console.log("exr loaded")}if(n.webP||n.avif){const c=await je.loadAsync(n.webP||n.avif);c.mapping=L,c.colorSpace=D,s.background=c,console.log("bg loaded"),f.groundProjection&&x(f.environment)}n.sunPos?(e.visible=!0,e.position.fromArray(n.sunPos)):e.visible=!1,n.sunCol?e.color.set(n.sunCol):e.color.set(16777215),n.shadowOpacity&&(a.material.opacity=n.shadowOpacity)}function x(n){f.groundProjection&&s.background&&n.groundProj?(m||(m=new xe(s.background),m.scale.setScalar(100)),m.material.uniforms.map.value=s.background,m.radius=n.groundProj.radius,m.height=n.groundProj.height,m.parent||s.add(m)):m&&m.parent&&m.removeFromParent()}t(f.environment),C.add(f,"environment",N).onChange(n=>{t(n)}),C.add(f,"groundProjection").onChange(n=>{x(f.environment)})}function Ae(){h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),d.setSize(window.innerWidth,window.innerHeight)}function He(){E.update(),p.update(),K(),d.render(s,h)}function Q(){requestAnimationFrame(Q),He()}function Oe(){if(W.setFromCamera(R,h),W.intersectObject(M,!0,w),!w.length){u.detach();return}w[0].object.selectOnRaycast?u.attach(w[0].object.selectOnRaycast):u.attach(w[0].object),w.length=0}function I(o){R.x=o.clientX/window.innerWidth*2-1,R.y=-(o.clientY/window.innerHeight)*2+1}async function Be(){const o=new T(new he(.5).translate(0,.5,0),new H({color:_(),roughness:0,metalness:1}));o.name="sphere",o.castShadow=!0,o.receiveShadow=!0,o.position.set(2,0,-1.5),M.add(o);const e=new T(new pe(1,1,1).translate(0,.5,0),new H({color:_(),roughness:0,metalness:1}));e.name="cube",e.castShadow=!0,e.receiveShadow=!0,e.position.set(-2,0,-1.5),M.add(e),We()}async function We(){const o={default:"def",physical:"phy",transmission:"tra"},e={carMaterial:o.default},a={renderEachMesh:!1,enabled:!1,customBackground:s.background,backside:!0,thickness:1,backsideThickness:.5},t=[],n=(await Y.loadAsync(Te.porsche_1975.url)).scene;n.name="car";let c;const U=new Ee,y=new Re(6,!1),j=new ge({roughness:0,transmission:1,thickness:1});n.traverse(i=>{if(i.isMesh){i.castShadow=!0,i.receiveShadow=!0,i.selectOnRaycast=n;const r=i.material;t.push({material:r,mesh:i,physical:j,transmission:y}),i.name==="body"&&(c=i)}}),M.add(n),b.add(e,"carMaterial",o).onChange(i=>{for(const r of t)i===o.default&&(r.mesh.material=r.material,a.enabled=!1),i===o.physical&&(r.mesh.material=r.physical,a.enabled=!1),i===o.transmission&&(r.mesh.material=r.transmission,a.enabled=!0)}),ze(b,j),Ie(b,y,a);const F=new O(512,512,{minFilter:k,magFilter:k,colorSpace:d.outputColorSpace,type:B}),S=new O(512,512,{minFilter:k,magFilter:k,colorSpace:d.outputColorSpace,type:B}),g=y;g.buffer=S.texture;let G,v,A;const l={gl:d,scene:s,camera:h};let P;const Z=[{mesh:c,mat:y}],$=new Se(!0);K=()=>{if(a.enabled){g.time=$.getElapsedTime(),a.renderEachMesh?P=t:P=Z;for(let i=0;i<P.length;i++){const r=t[i].mesh;g.buffer===S.texture&&(v=l.gl.toneMapping,G=l.scene.background,A=r.material.side,l.gl.toneMapping=ke,a.background&&(l.scene.background=a.background),r.material=U,a.backside&&(l.gl.setRenderTarget(F),l.gl.render(l.scene,l.camera),r.material=g,r.material.buffer=F.texture,r.material.thickness=a.backsideThickness,r.material.side=q),l.gl.setRenderTarget(S),l.gl.render(l.scene,l.camera),r.material=g,r.material.thickness=a.thickness,r.material.side=A,r.material.buffer=S.texture,l.scene.background=G,l.gl.setRenderTarget(null),l.gl.toneMapping=v)}}}}function ze(o,e){const a=o.addFolder("Physical Material");a.addColor(e,"color"),a.addColor(e,"attenuationColor"),a.add(e,"side",{FrontSide:Me,BackSide:q,DoubleSide:be}),a.add(e,"attenuationDistance",0,2),a.add(e,"roughness",0,1),a.add(e,"transmission",0,1),a.add(e,"thickness",0,2),a.add(e,"reflectivity",0,1)}function Ie(o,e,a){const t=o.addFolder("Transmission Material");t.add(a,"enabled").name("Rendering Enabled").listen(),t.add(a,"backside"),t.add(a,"thickness",0,2),t.add(a,"backsideThickness",0,2),t.addColor(e,"color"),t.addColor(e,"attenuationColor"),t.add(e,"_transmission",0,1),t.add(e,"attenuationDistance",0,2),t.add(e,"roughness",0,1),t.add(e,"chromaticAberration",0,2),t.add(e,"distortion",0,10),t.add(e,"temporalDistortion",0,1),t.add(e,"anisotropicBlur",0,10),t.add(e,"reflectivity",0,1),t.add(a,"renderEachMesh").name("âš  Render Each Mesh separately")}const _e=new X;function _(){return"#"+_e.setHSL(Math.random(),.5,.5).getHexString()}export{Ze as default};
