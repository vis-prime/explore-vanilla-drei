import{S as A,W as H,V as W,a as P,A as z,b as V,c as I,G as N,O as _,d as q,R as X,i as Y,k as v,H as D,L as g,n as J,o as K,N as Q,m as U}from"./OrbitControls-R0lqBEeo.js";import{T as Z}from"./TransformControls-C9PpcTYI.js";import{M as $}from"./MODEL_LIST-CX7Ggjim.js";import{B as ee}from"./BG_ENV-DvPFx4cR.js";import{M as te}from"./MeshDiscardMaterial-UfTKQmYb.js";import{M as ae}from"./MeshTransmissionMaterial-PT71Sorh.js";import"./EXRLoader-CueWY_mu.js";import"./RGBELoader-C-6F00h6.js";import"./GroundProjectedSkybox-C8DAfX2s.js";import"./HDRI_LIST-DJCqOZOR.js";import"./shaderMaterial-CnuFB52m.js";let b,a,d,p,c,M,k=new q;const T=new N,G=new Y,x=new J;let r;x.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.5/");G.setDRACOLoader(x);const E=new X,m=[];let j=()=>{},h;async function Me(n){M=n,h=M.addFolder("Scene"),b=new A,app.appendChild(b.dom),a=new H({antialias:!0}),a.setPixelRatio(Math.min(1.5,window.devicePixelRatio)),a.setSize(window.innerWidth,window.innerHeight),a.shadowMap.enabled=!0,a.shadowMap.type=W,a.outputColorSpace=P,a.toneMapping=z,app.appendChild(a.domElement),d=new V(50,window.innerWidth/window.innerHeight,.1,200),d.position.set(2,2,2),d.name="Camera",p=new I,p.add(T),c=new _(d,a.domElement),c.enableDamping=!0,c.dampingFactor=.05,c.minDistance=.1,c.maxDistance=100,c.maxPolarAngle=Math.PI/1.5,c.target.set(0,.5,0),r=new Z(d,a.domElement),r.addEventListener("dragging-changed",e=>{c.enabled=!e.value,e.value}),r.addEventListener("change",()=>{r.object&&r.object.position.y<0&&(r.object.position.y=0)}),p.add(r.getHelper()),window.addEventListener("resize",ne),document.addEventListener("pointermove",F);let o=Date.now();app.addEventListener("pointerdown",()=>{o=Date.now()}),app.addEventListener("pointerup",e=>{Date.now()-o<200&&(F(e),ie())}),h.add(r,"mode",["translate","rotate","scale"]);const i=new ee(p);i.setBGType("GroundProjection"),i.setEnvType("HDRI"),i.updateAll(),i.addGui(h),await re(),B()}function ne(){d.aspect=window.innerWidth/window.innerHeight,d.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight)}function oe(){b.update(),c.update(),j(),a.render(p,d)}function B(){requestAnimationFrame(B),oe()}function ie(){if(E.setFromCamera(k,d),E.intersectObject(T,!0,m),!m.length){r.detach();return}m[0].object.selectOnRaycast?r.attach(m[0].object.selectOnRaycast):r.attach(m[0].object),m.length=0}function F(n){k.x=n.clientX/window.innerWidth*2-1,k.y=-(n.clientY/window.innerHeight)*2+1}async function re(){const n={customBackground:p.background,backside:!0,thickness:1,backsideThickness:.5},i=(await G.loadAsync($.monkey.url)).scene,e=new te,f=new ae({anisotropy:.5}),y=[];i.traverse(l=>{l.isMesh&&(l.castShadow=!0,l.receiveShadow=!0,l.selectOnRaycast=i,l.material=f,y.push(l))}),T.add(i),se(M,f,n);const S=new v(512,512,{minFilter:g,magFilter:g,colorSpace:a.outputColorSpace,type:D}),w=new v(512,512,{minFilter:g,magFilter:g,colorSpace:a.outputColorSpace,type:D}),u=f;u.buffer=w.texture;let C,L,R;const t={gl:a,scene:p,camera:d},O=new K(!0);j=()=>{u.time=O.getElapsedTime();for(const l of y){const s=l;u.buffer===w.texture&&(L=t.gl.toneMapping,C=t.scene.background,R=s.material.side,t.gl.toneMapping=Q,n.background&&(t.scene.background=n.background),s.material=e,n.backside&&(t.gl.setRenderTarget(S),t.gl.render(t.scene,t.camera),s.material=u,s.material.buffer=S.texture,s.material.thickness=n.backsideThickness,s.material.side=U),t.gl.setRenderTarget(w),t.gl.render(t.scene,t.camera),s.material=u,s.material.thickness=n.thickness,s.material.side=R,s.material.buffer=w.texture,t.scene.background=C,t.gl.setRenderTarget(null),t.gl.toneMapping=L)}}}function se(n,o,i){const e=n.addFolder("Transmission Material");e.open(),e.add(i,"backside"),e.add(i,"thickness",0,2),e.add(i,"backsideThickness",0,2),e.addColor(o,"color"),e.add(o,"roughness",0,1),e.add(o,"chromaticAberration",0,2),e.add(o,"distortion",0,10),e.add(o,"temporalDistortion",0,1),e.add(o,"anisotropicBlur",0,10),e.add(o,"reflectivity",0,1),e.addColor(o,"attenuationColor"),e.add(o,"attenuationDistance",0,2)}export{Me as default};
